# Activation du moteur de réécriture
RewriteEngine On

# Redirections permanentes (308) afin de préserver la méthode HTTP et le corps de la requête
# Ancien endpoint POST du microcontrôleur → nouvelle route interne
# désactivé : l'ESP32 ne gère pas les redirections 308 ;
# la route /post-ffp3-data.php est gérée directement par l'application.
# RewriteRule ^post-ffp3-data\.php$ post-data [R=308,L]

# Ancien endpoint d'export CSV → nouvelle route interne
RewriteRule ^export-data\.php$ /ffp3/ffp3datas/export-data [R=308,L]

# Ancienne page publique legacy → nouvelle route interne
RewriteRule ^ffp3-data\.php$ /ffp3/ffp3datas/aquaponie [R=308,L] 

# -----------------------------------------------------------------------------
# Réécriture des assets : /assets/* → /public/assets/*
# Permet d'accéder aux fichiers CSS/JS/images via /ffp3/assets/ au lieu de /ffp3/public/assets/
# -----------------------------------------------------------------------------
RewriteCond %{REQUEST_URI} ^/assets/(.*)$
RewriteCond %{DOCUMENT_ROOT}/ffp3/public/assets/%1 -f [OR]
RewriteCond %{DOCUMENT_ROOT}/ffp3/public/assets/%1 -d
RewriteRule ^assets/(.*)$ public/assets/$1 [L]

# Réécriture du manifest.json et service-worker.js
RewriteCond %{REQUEST_URI} ^/(manifest\.json|service-worker\.js)$
RewriteCond %{DOCUMENT_ROOT}/ffp3/public/%1 -f
RewriteRule ^(.*)$ public/$1 [L]

# -----------------------------------------------------------------------------
# Router générique : toute requête qui ne correspond pas à un fichier ou dossier
# existant est orientée vers le front-controller public/index.php
# -----------------------------------------------------------------------------
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^ public/index.php [L] 