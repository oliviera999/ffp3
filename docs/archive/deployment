================================================================================
üöÄ INSTRUCTIONS DE D√âPLOIEMENT FFP3 v4.4.1
================================================================================

Date: 2025-10-11
Objectif: D√©ployer v4.4.1 avec WaterBalanceService et affichage firmware ESP32

================================================================================
√âTAPE 1 : CONNEXION AU SERVEUR
================================================================================

Ouvrir un terminal et se connecter :

    ssh oliviera@toaster

Puis naviguer vers le dossier FFP3 :

    cd /home4/oliviera/iot.olution.info/ffp3

================================================================================
√âTAPE 2 : V√âRIFIER LA VERSION ACTUELLE (optionnel)
================================================================================

    cat VERSION

(devrait afficher une version inf√©rieure √† 4.4.1)

================================================================================
√âTAPE 3 : EX√âCUTER LE SCRIPT DE D√âPLOIEMENT
================================================================================

Lancer le script de d√©ploiement :

    bash DEPLOY_NOW.sh

Le script va automatiquement :
‚úì Pull depuis GitHub (origin/main)
‚úì Supprimer vendor/ corrompu
‚úì R√©installer les d√©pendances Composer
‚úì V√©rifier l'int√©grit√© (PHP-DI, web-push, bacon-qr-code)
‚úì Ajuster les permissions
‚úì Afficher la version d√©ploy√©e (4.4.1)

‚è±Ô∏è  Dur√©e estim√©e : 1-2 minutes

================================================================================
√âTAPE 4 : V√âRIFICATION POST-D√âPLOIEMENT
================================================================================

1. Ouvrir dans le navigateur :
   
   https://iot.olution.info/ffp3/aquaponie

2. V√©rifier que les √©l√©ments suivants sont pr√©sents :

   ‚úÖ Section "Bilan Hydrique" avec :
      - R√©serve d'eau (consommation/ravitaillement/bilan)
      - Cycles de mar√©e (marnage/fr√©quence/cycles)
   
   ‚úÖ Footer en bas de page avec :
      "v4.4.1 | Firmware ESP32: v11.05 | Syst√®me d'aquaponie FFP3"
   
   ‚úÖ Badge "LIVE" en haut √† droite (vert apr√®s 15 secondes)
   
   ‚úÖ Graphiques s'affichent correctement

3. Tester aussi la page de contr√¥le :
   
   https://iot.olution.info/ffp3/control

4. Comparer PROD et TEST (doivent √™tre identiques maintenant) :
   
   https://iot.olution.info/ffp3/aquaponie         (PROD)
   https://iot.olution.info/ffp3/aquaponie-test    (TEST)

================================================================================
√âTAPE 5 : TESTS FONCTIONNELS
================================================================================

1. Ouvrir la console du navigateur (F12) :
   - Onglet "Console"
   - Chercher logs "[RealtimeUpdater]"
   - V√©rifier absence d'erreurs JavaScript

2. Tester l'API en direct :
   
   curl https://iot.olution.info/ffp3/api/realtime/sensors/latest
   
   (doit retourner JSON avec derni√®res mesures)

3. V√©rifier les logs serveur (si erreur) :
   
   tail -n 50 error_log

================================================================================
EN CAS DE PROBL√àME
================================================================================

Si le d√©ploiement √©choue au niveau de Composer :

    composer clear-cache
    composer update --no-dev --optimize-autoloader

Si erreur 500 apr√®s d√©ploiement :

    # V√©rifier les logs
    tail -n 100 error_log
    
    # V√©rifier les permissions
    chmod -R 755 public/
    chmod -R 775 var/cache/

Si autoload ne fonctionne pas :

    rm -rf vendor/
    composer install --no-dev --optimize-autoloader

================================================================================
SUCC√àS !
================================================================================

Une fois le d√©ploiement r√©ussi, vous devriez voir :

‚úÖ Version v4.4.1 affich√©e
‚úÖ Bilan Hydrique pr√©sent sur /aquaponie
‚úÖ Firmware ESP32 affich√© dans le footer
‚úÖ Badge LIVE fonctionnel
‚úÖ Aucune erreur dans la console

Le syst√®me PROD a maintenant toutes les fonctionnalit√©s de TEST !

================================================================================

