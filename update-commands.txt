# Commandes pour forcer la mise à jour sur le serveur
# À exécuter dans l'ordre sur le serveur iot.olution.info

# 1. Sauvegarder les modifications locales
cp public/index.php public/index.php.backup.$(date +%Y%m%d_%H%M%S)

# 2. Option A: Reset hard (recommandé)
git fetch origin
git reset --hard origin/main

# 2. Option B: Si Option A échoue
git checkout -- .
git pull origin main

# 3. Nettoyer le cache
rm -rf var/cache/di/*
mkdir -p var/cache/di
chmod -R 755 var/cache/

# 4. Corriger les permissions
chmod 644 public/index.php
chmod 644 config/container.php
chmod 644 config/dependencies.php

# 5. Tester l'application
php -r "require_once 'vendor/autoload.php'; echo 'OK';"

# 6. Tester le site
curl -I https://iot.olution.info/ffp3/
