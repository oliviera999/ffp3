# Changelog FFP3 Datas

Toutes les modifications notables de ce projet seront document√©es dans ce fichier.

Le format est bas√© sur [Keep a Changelog](https://keepachangelog.com/fr/1.0.0/),
et ce projet adh√®re √† [Semantic Versioning](https://semver.org/lang/fr/).

---

## [4.5.22] - 2025-10-13 üé® Interface compacte - Param√®tres sur lignes multiples

### ‚ú® Am√©liorations

#### Organisation compacte des param√®tres de contr√¥le
- **Am√©lioration** : R√©organisation de tous les param√®tres pour un affichage plus compact
- **Nourrissage - Horaires** : Matin, Midi, Soir sur la m√™me ligne (3 colonnes)
- **Nourrissage - Dur√©es** : Gros poissons, Petits poissons sur la m√™me ligne (2 colonnes)
- **Gestion de l'eau - Ligne 1** : Aquarium bas, D√©bordement (2 colonnes)
- **Gestion de l'eau - Ligne 2** : Remplissage, R√©serve basse (2 colonnes)
- **Technique** : Grilles CSS responsives avec `display: grid`

- **Fichiers modifi√©s** :
  - `templates/control.twig` (lignes 967-992, 994-1008)

- **Impact** :
  - ‚úÖ Interface beaucoup plus compacte
  - ‚úÖ Meilleure utilisation de l'espace horizontal
  - ‚úÖ Moins de d√©filement vertical n√©cessaire
  - ‚úÖ Lisibilit√© am√©lior√©e avec regroupement logique des param√®tres
  - ‚úÖ Responsive sur desktop, tablette et mobile

---

## [4.5.21] - 2025-10-13 üé® Am√©lioration interface nourrissage

### ‚ú® Am√©liorations

#### Affichage des dur√©es de nourrissage sur la m√™me ligne
- **Am√©lioration** : Les champs "Gros poissons" et "Petits poissons" sont maintenant c√¥te √† c√¥te
- **B√©n√©fice** : Interface plus compacte et lisible pour les dur√©es de nourrissage
- **Technique** : Grille CSS √† 2 colonnes (`display: grid; grid-template-columns: 1fr 1fr; gap: 10px`)
- **Responsive** : Fonctionne sur desktop, tablette et mobile

- **Fichiers modifi√©s** :
  - `templates/control.twig` (lignes 1004-1015)

- **Impact** :
  - ‚úÖ Interface plus compacte
  - ‚úÖ Meilleure lisibilit√© des param√®tres de nourrissage
  - ‚úÖ Gain de place vertical

---

## [4.5.20] - 2025-10-13 üîß Renforcement affichage ic√¥nes Font Awesome

### üêõ Corrections de bugs

#### Renforcement du CSS pour affichage des ic√¥nes Font Awesome
- **Probl√®me** : Les ic√¥nes Font Awesome n'apparaissent toujours pas sur certains navigateurs (cases blanches)
- **Cause** : Conflits CSS avec `main.css` qui √©crase les styles Font Awesome
- **Solutions appliqu√©es** :
  - Ajout du pr√©chargement du fichier de police Font Awesome (`fa-solid-900.woff2`)
  - Renforcement des r√®gles CSS avec plus de s√©lecteurs sp√©cifiques
  - Ajout de propri√©t√©s CSS suppl√©mentaires (`font-style`, `font-variant`, `text-rendering`, etc.)
  - Override des styles pour tous les s√©lecteurs d'ic√¥nes (`[class^="fa-"]`, `[class*=" fa-"]`)
  - Ajout d'un script de v√©rification du chargement de Font Awesome au d√©marrage
  - Message d'erreur visible si Font Awesome ne se charge pas correctement

- **Fichiers modifi√©s** :
  - `templates/control.twig` (lignes 12-14, 116-154, 1132-1169)

- **Impact** :
  - ‚úÖ Ic√¥nes Font Awesome forc√©es √† s'afficher m√™me avec conflits CSS
  - ‚úÖ D√©tection automatique des probl√®mes de chargement
  - ‚úÖ Message d'erreur visible pour l'utilisateur si probl√®me
  - ‚úÖ Logs dans la console pour diagnostic

---

## [4.5.19] - 2025-10-13 üêõ Correction cycle infini pompe r√©servoir (logique invers√©e)

### üêõ Corrections de bugs

#### Correction du refill pompe r√©servoir qui se r√©p√®te sans s'arr√™ter
- **Probl√®me identifi√©** : 
  - Lorsque la pompe r√©servoir (refill) est activ√©e depuis le serveur distant, elle se d√©clenche en boucle infinie
  - L'ESP32 re√ßoit en continu des commandes contradictoires
  - La pompe d√©marre/arr√™te de fa√ßon r√©p√©t√©e sans respecter la dur√©e configur√©e
  
- **Cause racine** :
  - **D√©saccord de logique invers√©e** entre le serveur distant et l'ESP32
  - **C√¥t√© hardware/serveur** : GPIO 18 utilise une logique invers√©e (0 = ON, 1 = OFF)
  - **C√¥t√© ESP32** : S'attend √† une logique normale (`pump_tank=1` = ON, `pump_tank=0` = OFF)
  
- **Sc√©nario du bug** :
  1. Utilisateur active la pompe depuis le serveur distant
  2. Serveur √©crit GPIO 18 = 0 (pompe ON selon logique invers√©e)
  3. Serveur renvoie `pump_tank=0` √† l'ESP32 (valeur brute du GPIO)
  4. ESP32 lit `pump_tank=0` (false) ‚Üí arr√™te la pompe
  5. Serveur garde GPIO 18 = 0 en BDD
  6. √Ä la prochaine synchro ‚Üí retour √† l'√©tape 3 (boucle infinie)
  
- **Solution appliqu√©e** :
  - Inversion de la logique dans `OutputController::getOutputsState()` pour GPIO 18
  - GPIO 18 = 0 (hardware) ‚Üí `pump_tank=1` (envoy√© √† l'ESP32)
  - GPIO 18 = 1 (hardware) ‚Üí `pump_tank=0` (envoy√© √† l'ESP32)
  - Maintient la compatibilit√© avec la logique hardware existante
  - Transparent pour l'interface web (qui √©crit directement dans GPIO)

- **Fichiers modifi√©s** :
  - `src/Controller/OutputController.php` (lignes 148-154)

- **Impact** :
  - ‚úÖ √âlimine le cycle infini de d√©marrage/arr√™t
  - ‚úÖ La pompe r√©servoir respecte maintenant la dur√©e configur√©e
  - ‚úÖ Synchronisation correcte entre serveur distant et ESP32
  - ‚úÖ Pas d'impact sur les autres pompes/actionneurs
  - ‚úÖ Compatible avec l'existant (pas de migration BDD n√©cessaire)

- **Tests √† effectuer** :
  - [ ] Activer la pompe r√©servoir depuis l'interface web distante
  - [ ] V√©rifier que la pompe s'arr√™te apr√®s la dur√©e configur√©e
  - [ ] V√©rifier que `pump_tank` refl√®te bien l'√©tat r√©el de la pompe
  - [ ] V√©rifier les autres GPIO (pompe aquarium, lumi√®re, chauffage)

---

## [4.5.18] - 2025-10-13 üêõ Correction erreur JavaScript dans ChartUpdater

### üêõ Corrections de bugs

#### Correction de l'erreur "Cannot read properties of undefined (reading 'x')"
- **Probl√®me identifi√©** : 
  - Erreur JavaScript r√©currente dans `chart-updater.js` ligne 225
  - Se produit lors de la mise √† jour des graphiques en temps r√©el
  - Message d'erreur : `TypeError: Cannot read properties of undefined (reading 'x')`
  - Bloque partiellement les mises √† jour en direct des graphiques
  
- **Cause** :
  - Le tableau `series.data` de Highcharts peut contenir des entr√©es `null` ou `undefined` apr√®s certaines op√©rations
  - La v√©rification `p && p.x === update.timestamp` n'√©tait pas suffisamment robuste
  - Cas o√π `update` lui-m√™me pourrait √™tre invalide ou incomplet
  
- **Solution appliqu√©e** :
  - Ajout d'une v√©rification de l'existence de `series.data` (ligne 218)
  - Validation des donn√©es de `update` avant traitement (lignes 225-228)
  - Am√©lioration de la v√©rification du point existant avec `typeof p.x !== 'undefined'` (ligne 232)
  - Logs d'avertissement pour faciliter le d√©bogage futur

- **Fichiers modifi√©s** :
  - `public/assets/js/chart-updater.js`

- **Impact** :
  - ‚úÖ √âlimine l'erreur JavaScript r√©currente
  - ‚úÖ Am√©liore la robustesse des mises √† jour en temps r√©el
  - ‚úÖ Meilleure gestion des cas limites (edge cases)
  - ‚úÖ Logs plus informatifs pour le d√©bogage

---

## [4.5.17] - 2025-10-13 üêõ Correction cr√©ation automatique de doublons GPIO

### üêõ Corrections de bugs

#### Correction du probl√®me de lignes dupliqu√©es dans ffp3Outputs
- **Probl√®me identifi√©** : 
  - 4 lignes vides avec `gpio=16` (et potentiellement d'autres GPIO) se cr√©ent automatiquement et syst√©matiquement dans `ffp3Outputs`
  - Quand supprim√©es manuellement, elles sont recr√©√©es automatiquement avec de nouveaux ID
  - Probl√®me absent dans `ffp3Outputs2` (environnement TEST)
  - Cause : Le `PumpService.php` cr√©ait une nouvelle ligne √† chaque `UPDATE` infructueux, sans v√©rifier l'existence de doublons
  
- **Analyse de la cause** :
  - Le code `PumpService::setState()` (lignes 68-72) faisait un `UPDATE` puis un `INSERT` si aucune ligne n'√©tait affect√©e
  - Aucune contrainte UNIQUE sur la colonne `gpio` n'emp√™chait les doublons
  - Les commandes CRON (`ProcessTasksCommand`, `CleanDataCommand`, `RestartPumpCommand`) appellent fr√©quemment les m√©thodes de contr√¥le des pompes
  - Chaque appel pouvait cr√©er une nouvelle ligne vide si la ligne initiale √©tait supprim√©e

- **Solutions appliqu√©es** :

  **1. Modification du PumpService.php**
  - Remplacement de la logique `UPDATE` + `INSERT` par `INSERT ... ON DUPLICATE KEY UPDATE`
  - **Avant** : 
    ```php
    UPDATE ffp3Outputs SET state = :state WHERE gpio = :gpio
    if (rowCount == 0) INSERT INTO ffp3Outputs (gpio, state) VALUES (...)
    ```
  - **Apr√®s** :
    ```php
    INSERT INTO ffp3Outputs (gpio, state, name, board) 
    VALUES (:gpio, :state, '', '') 
    ON DUPLICATE KEY UPDATE state = :state
    ```
  - Cette syntaxe MySQL/MariaDB √©vite les doublons et met √† jour la ligne existante automatiquement

  **2. Cr√©ation des scripts de migration SQL**
  - `migrations/FIX_DUPLICATE_GPIO_ROWS.sql` :
    - Nettoyage automatique de tous les doublons existants dans `ffp3Outputs` et `ffp3Outputs2`
    - Pr√©servation des lignes avec le plus de donn√©es (nom, board, description)
    - Ajout d'une contrainte `UNIQUE` sur la colonne `gpio` dans les deux tables
    - V√©rifications avant/apr√®s pour validation
  
  - `migrations/INIT_GPIO_BASE_ROWS.sql` :
    - Initialisation de toutes les lignes GPIO n√©cessaires (2, 15, 16, 18, 100-116)
    - Attribution de noms, boards et descriptions appropri√©s :
      - GPIO physiques : 2 (Chauffage), 15 (UV), 16 (Pompe Aquarium), 18 (Pompe R√©serve)
      - GPIO virtuels : 100-116 (param√®tres de configuration)
    - Synchronisation automatique entre `ffp3Outputs` et `ffp3Outputs2`
  
  - `migrations/README.md` : Documentation compl√®te de la proc√©dure d'application des migrations

- **Impact** :
  - ‚úÖ Plus aucune cr√©ation automatique de doublons gr√¢ce √† la contrainte UNIQUE
  - ‚úÖ Code plus robuste et conforme aux standards SQL
  - ‚úÖ Toutes les lignes GPIO ont maintenant des noms et descriptions clairs
  - ‚úÖ Pr√©vention garantie des futurs doublons au niveau base de donn√©es

### üîß Fichiers modifi√©s
- `src/Service/PumpService.php` : M√©thode `setState()` refactoris√©e avec INSERT ON DUPLICATE KEY UPDATE

### üìÅ Fichiers cr√©√©s
- `migrations/FIX_DUPLICATE_GPIO_ROWS.sql` : Script de nettoyage des doublons et ajout contrainte UNIQUE
- `migrations/INIT_GPIO_BASE_ROWS.sql` : Script d'initialisation des GPIO de base avec noms appropri√©s
- `migrations/README.md` : Documentation compl√®te des migrations

### üìã Actions requises (IMPORTANT)
**√Ä ex√©cuter sur le serveur de production** :
```bash
# 1. Sauvegarde pr√©ventive
mysqldump -u oliviera_iot -p oliviera_iot ffp3Outputs ffp3Outputs2 > backup_outputs.sql

# 2. Application de la correction
mysql -u oliviera_iot -p oliviera_iot < migrations/FIX_DUPLICATE_GPIO_ROWS.sql

# 3. Initialisation des GPIO (recommand√©)
mysql -u oliviera_iot -p oliviera_iot < migrations/INIT_GPIO_BASE_ROWS.sql
```

Consulter `migrations/README.md` pour la proc√©dure d√©taill√©e.

### üìù Notes techniques
- La contrainte `UNIQUE` sur `gpio` emp√™chera MySQL d'accepter des doublons √† l'avenir
- La syntaxe `ON DUPLICATE KEY UPDATE` est sp√©cifique √† MySQL/MariaDB
- Les deux environnements (PROD et TEST) sont trait√©s par les scripts de migration
- Le probl√®me n'affectait que l'environnement PROD car TEST avait probablement moins d'ex√©cutions CRON

---

## [4.5.16] - 2025-10-13 üêõ Correction bug ChartUpdater temps r√©el

### üêõ Corrections de bugs

#### Correction erreur JavaScript dans chart-updater.js
- **Probl√®me** : Erreur `TypeError: Cannot read properties of undefined (reading 'x')` √† la ligne 225
  - Se produisait lors de la mise √† jour temps r√©el des graphiques
  - Caus√©e par des √©l√©ments `undefined` dans le tableau `series.data` de Highcharts
  - Bloquait l'ajout de nouveaux points apr√®s quelques secondes de fonctionnement
- **Solution** : Ajout d'une v√©rification de s√©curit√© dans la fonction `find()`
  - **Avant** : `series.data.find(p => p.x === update.timestamp)`
  - **Apr√®s** : `series.data.find(p => p && p.x === update.timestamp)`
- **Impact** : Les graphiques se mettent d√©sormais √† jour en temps r√©el sans erreur

### üîß Fichiers modifi√©s
- `public/assets/js/chart-updater.js` : Ligne 225 - Ajout v√©rification `p &&`

### üìù Notes techniques
- Le probl√®me apparaissait dans la console apr√®s quelques cycles de mise √† jour
- Les points Highcharts peuvent √™tre `null` ou `undefined` apr√®s suppression (shift)
- La v√©rification `p &&` garantit que l'objet existe avant d'acc√©der √† ses propri√©t√©s

---

## [4.5.15] - 2025-10-13 üêõ Correction des liens de navigation

### üêõ Corrections de bugs

#### Correction des liens de redirection
- **Correction de tous les liens pointant vers l'ancienne URL**
  - **Probl√®me** : Les liens dans plusieurs pages pointaient vers `/ffp3/ffp3datas/ffp3-data.php` (ancienne structure)
  - **Solution** : Mise √† jour vers la nouvelle structure Slim 4
  - **Avant** : `https://iot.olution.info/ffp3/ffp3datas/ffp3-data.php`
  - **Apr√®s** : `https://iot.olution.info/ffp3/aquaponie` (PROD) et `/ffp3/aquaponie-test` (TEST)
  - **Impact** : Navigation coh√©rente dans toute l'application

### üîß Fichiers modifi√©s
- `index.php` : Correction de la redirection 301
- `ffp3control/securecontrol/ffp3-outputs.php` : Mise √† jour du lien de navigation
- `ffp3control/securecontrol/ffp3-outputs2.php` : Mise √† jour vers `/aquaponie-test`
- `ffp3control/securecontrol/test2/ffp3-outputs.php` : Mise √† jour vers `/aquaponie-test`
- `ffp3gallery/ffp3-gallery.php` : Correction de 2 liens (navigation + bouton retour)

### üìù Notes
- Les liens dans `index.html` √©taient d√©j√† corrects
- Seuls les fichiers actifs ont √©t√© corrig√©s (pas le dossier `unused/`)
- Les versions TEST redirigent correctement vers `/aquaponie-test`

---

## [4.5.14] - 2025-10-13 üêõ Correction ExportController vers PSR-7

### üêõ Corrections de bugs

#### Architecture PSR-7 dans ExportController
- **Migration compl√®te de `ExportController` vers PSR-7**
  - Suite de la correction de v4.5.13, alignement de tous les contr√¥leurs API vers PSR-7
  - **Avant** : Utilisation de `echo`, `header()`, `http_response_code()`, `$_GET`
  - **Apr√®s** : Objets PSR-7 `Request` et `Response` correctement utilis√©s
  - Signature chang√©e : `downloadCsv(): void` ‚Üí `downloadCsv(Request $request, Response $response): Response`
  - Remplacement de `$_GET` par `$request->getQueryParams()`
  - Remplacement de `echo` par `$response->getBody()->write()`
  - Remplacement de `http_response_code()` par `$response->withStatus()`
  - Remplacement de `header()` par `$response->withHeader()`
  - Gestion du streaming CSV adapt√© pour PSR-7 avec `file_get_contents()`
  - **Impact** : Export CSV plus robuste et coh√©rent avec l'architecture globale
  - Pr√©vention des probl√®mes potentiels de buffer mixing
  - Meilleure gestion des erreurs HTTP

### üîß Fichiers modifi√©s
- `src/Controller/ExportController.php` : Migration compl√®te vers PSR-7

### üìä √âtat de l'architecture
Tous les contr√¥leurs API sont maintenant align√©s sur PSR-7 :
- ‚úÖ `PostDataController` (v4.5.13)
- ‚úÖ `ExportController` (v4.5.14)
- ‚úÖ `HeartbeatController` (d√©j√† PSR-7)
- ‚úÖ `RealtimeApiController` (d√©j√† PSR-7)
- ‚úÖ `OutputController` (d√©j√† PSR-7)

Contr√¥leurs HTML (moins critiques) :
- üü° `AquaponieController` (legacy - √† migrer ult√©rieurement)
- üü° `DashboardController` (legacy - √† migrer ult√©rieurement)
- üü° `TideStatsController` (legacy - √† migrer ult√©rieurement)

---

## [4.5.13] - 2025-10-13 üêõ Correction critique HTTP 500 sur endpoint ESP32

### üêõ Corrections de bugs

#### Architecture PSR-7 dans PostDataController
- **Correction du probl√®me HTTP 500 sur `/post-data-test` et `/post-data`**
  - L'ESP32 recevait syst√©matiquement HTTP 500 alors que les donn√©es √©taient correctement ins√©r√©es en BDD
  - **Cause** : Le contr√¥leur `PostDataController` utilisait l'ancienne approche PHP (`echo`, `header()`, `http_response_code()`) incompatible avec l'architecture Slim 4 / PSR-7
  - **Sympt√¥mes** : Messages de r√©ponse concat√©n√©s ("Donn√©es enregistr√©es avec succ√®s" + message d'erreur)
  - **Solution** : Migration compl√®te vers les objets PSR-7 `Request` et `Response`
  - Signature chang√©e : `handle(): void` ‚Üí `handle(Request $request, Response $response): Response`
  - Remplacement de tous les `echo` par `$response->getBody()->write()`
  - Remplacement de tous les `http_response_code()` par `$response->withStatus()`
  - Utilisation de `$request->getParsedBody()` au lieu de `$_POST`
  - **Impact** : L'ESP32 re√ßoit maintenant correctement HTTP 200 lors d'une insertion r√©ussie
  - Fin des erreurs de retry inutiles c√¥t√© ESP32
  - Coh√©rence avec les autres contr√¥leurs (`HeartbeatController`, etc.)

### üîß Fichiers modifi√©s
- `src/Controller/PostDataController.php` : Migration compl√®te vers PSR-7

### üìä Contexte technique
Cette correction r√©sout le probl√®me identifi√© lors de l'analyse des logs ESP32 o√π :
1. ‚úÖ Les donn√©es √©taient bien ins√©r√©es en BDD
2. ‚ùå Le serveur renvoyait HTTP 500 au lieu de 200
3. ‚ùå L'ESP32 effectuait 3 tentatives infructueuses (retry)
4. ‚ùå Risque de duplication de donn√©es

---

## [4.5.12] - 2025-10-13 üêõ Correction logs "GPIO NaN" dans la synchronisation

### üêõ Corrections de bugs

#### Synchronisation temps r√©el de l'interface de contr√¥le
- **Correction du probl√®me "GPIO NaN changed" dans les logs de la console**
  - L'API `/api/outputs/state` retourne √† la fois des cl√©s num√©riques (GPIOs) et des cl√©s textuelles (noms comme "mail", "heat", "light") pour la compatibilit√© ESP32
  - Le script `control-sync.js` tentait de convertir toutes les cl√©s en nombres avec `parseInt()`, produisant `NaN` pour les cl√©s non num√©riques
  - Solution : Ajout d'une v√©rification `isNaN()` pour ignorer les cl√©s non num√©riques qui sont des alias
  - Les logs affichent maintenant correctement uniquement les GPIOs num√©riques valides
  - Cela √©vite √©galement un traitement inutile et des notifications en double

### üîß Fichiers modifi√©s
- `public/assets/js/control-sync.js` : Ajout du filtrage des cl√©s non num√©riques dans `processStates()`

---

## [4.5.11] - 2025-10-13 üêõ Correction d√©calage horaire au chargement initial

### üêõ Corrections de bugs

#### Affichage des dates/heures
- **Correction du d√©calage de +1h au chargement initial de la page aquaponie**
  - Les dates PHP √©taient affich√©es en timezone Europe/Paris (serveur)
  - JavaScript utilisait Africa/Casablanca (projet physique) pour les mises √† jour live
  - Cela cr√©ait un d√©calage d'1h au premier affichage, corrig√© ensuite par les updates
  - Solution : Appel imm√©diat de `statsUpdater.updateSummaryDates()` apr√®s initialisation
  - Les dates sont maintenant coh√©rentes d√®s le chargement initial avec le timezone Africa/Casablanca

### üîß Fichiers modifi√©s
- `templates/aquaponie.twig` : Ajout de l'appel `updateSummaryDates()` apr√®s initialisation des timestamps

---

## [4.5.10] - 2025-10-13 üêõ Correction affichage email

### üêõ Corrections de bugs

#### Formulaire de contr√¥le
- **Correction de l'affichage "NaN" dans le champ email**
  - Le script `control-sync.js` convertissait syst√©matiquement toutes les valeurs en nombres entiers avec `parseInt()`
  - Pour le GPIO 100 (email), cela produisait `NaN` au lieu de l'adresse email
  - Impl√©mentation d'une logique de typage intelligent :
    - GPIOs < 100 et switches sp√©ciaux (101, 108, 109, 110, 115) : conversion en entier (√©tat on/off)
    - GPIO 100 (email) : conservation comme cha√Æne de caract√®res
    - Autres param√®tres : tentative de conversion en nombre, sinon conservation comme cha√Æne
  - L'email s'affiche d√©sormais correctement dans le formulaire de configuration

### üîß Fichiers modifi√©s
- `public/assets/js/control-sync.js` : Refactorisation de la m√©thode `processStates()`

---

## [4.7.0] - 2025-10-13 üåç Gestion timezone et fen√™tre glissante am√©lior√©es

### ‚ú® Nouvelles fonctionnalit√©s

#### Fen√™tre glissante en mode live
- **Impl√©mentation d'une fen√™tre d'analyse glissante** (6h par d√©faut)
  - Au chargement : Affiche la p√©riode demand√©e (historique)
  - En mode live : La fen√™tre glisse automatiquement pour maintenir la dur√©e fixe
  - L'heure de d√©but s'ajuste quand de nouvelles donn√©es arrivent
  
#### Badge LIVE/HISTORIQUE
- **Indicateur visuel du mode d'analyse** avec badge anim√©
  - Badge `HISTORIQUE` (gris) : P√©riode fixe, pas de nouvelles donn√©es
  - Badge `LIVE` (rouge pulsant) : Fen√™tre glissante active avec donn√©es temps r√©el
  
#### Compteurs s√©par√©s
- **Distinction claire entre donn√©es historiques et live**
  - "Mesures charg√©es" : Nombre de mesures dans la p√©riode initiale
  - "Lectures live re√ßues" : Compteur incr√©mental des nouvelles donn√©es

### üåç Unification du timezone d'affichage

#### Configuration globale Africa/Casablanca
- **Ajout de `moment.tz.setDefault('Africa/Casablanca')`** dans `aquaponie.twig`
- **Configuration Highcharts** avec timezone `Africa/Casablanca`
- **Tous les affichages coh√©rents** en heure locale de Casablanca (heure r√©elle du projet physique)

#### Architecture timezone hybride
- **Backend (PHP)** : Stockage en `Europe/Paris` (stable, pas de migration n√©cessaire)
- **Frontend (JS)** : Affichage en `Africa/Casablanca` (conversion automatique)
- **D√©calage horaire** : 0h en hiver, -1h en √©t√© (Casablanca en retard sur Paris)

### üîß Am√©liorations techniques

#### Filtres rapides optimis√©s
- **Remplacement de `Date()` natif par moment-timezone** dans `setPeriod()`
- **Calcul des dates dans le timezone du serveur** (Africa/Casablanca)
- **Plus de probl√®mes de d√©calage** avec utilisateurs dans diff√©rents fuseaux

#### Indication timezone dans les formulaires
- **Ajout de label explicite** : "Heure de Casablanca (serveur: Paris +1h en hiver, √©gale en √©t√©)"
- **Clarification pour l'utilisateur** lors de la s√©lection de p√©riodes personnalis√©es

#### Commentaires et documentation
- **Clarification des conversions timestamps** (millisecondes Highcharts ‚Üí secondes Unix)
- **Commentaires explicites** sur la logique de fen√™tre glissante
- **Documentation compl√®te** dans `docs/TIMEZONE_MANAGEMENT.md`

### üìù Fichiers modifi√©s

#### Frontend
- `templates/aquaponie.twig`
  - Configuration globale moment.tz et Highcharts
  - Fonction `setPeriod()` avec moment-timezone
  - Badge mode LIVE/HISTORIQUE avec styles CSS
  - Indication timezone dans formulaires
  - Initialisation correcte de StatsUpdater

- `public/assets/js/stats-updater.js`
  - Propri√©t√©s pour fen√™tre glissante (`slidingWindow`, `windowDuration`)
  - S√©paration compteurs (`initialReadingCount`, `liveReadingCount`)
  - M√©thode `updatePeriodInfo()` avec logique fen√™tre glissante
  - M√©thode `updateModeBadge()` pour indicateur LIVE/HISTORIQUE
  - Commentaires clarifi√©s sur conversions timezone

#### Documentation
- `docs/TIMEZONE_MANAGEMENT.md`
  - Section "Modifications R√©centes (v4.7.0)"
  - Architecture timezone hybride document√©e
  - Gestion fen√™tre glissante expliqu√©e
  - Tableau r√©capitulatif mis √† jour

### üêõ Corrections de bugs

- **Fix : P√©riode d'analyse s'√©tendant ind√©finiment** en mode live (remplac√© par fen√™tre glissante)
- **Fix : Filtres rapides utilisant timezone navigateur** (maintenant timezone serveur)
- **Fix : Incoh√©rence timezone PHP vs JavaScript** (affichage unifi√© Africa/Casablanca)
- **Fix : Confusion compteur de mesures** (s√©paration historique/live)
- **Fix : Dur√©e calcul√©e incorrectement** en mode live (fen√™tre glissante fixe)

### üìä Impact utilisateur

- ‚úÖ **Affichage en heure locale r√©elle** (Casablanca) pour les utilisateurs au Maroc
- ‚úÖ **Fen√™tre d'analyse stable** qui ne s'√©tend plus ind√©finiment
- ‚úÖ **Distinction claire** entre donn√©es historiques et temps r√©el
- ‚úÖ **Filtres coh√©rents** quel que soit le timezone du navigateur
- ‚úÖ **Meilleure compr√©hension** du mode d'analyse (LIVE vs HISTORIQUE)

---

## [4.5.9] - 2025-10-13 üîß Correction ic√¥nes Font Awesome Control

### üêõ Corrig√© - Ic√¥nes invisibles
- **Probl√®me** : Les ic√¥nes Font Awesome n'apparaissaient pas dans l'interface de contr√¥le
- **Causes identifi√©es** :
  - Ic√¥nes avec noms inexistants (fa-alarm-clock, fa-fish-fins, fa-rotate)
  - CSS conflictuel √©crasant les styles Font Awesome
  - Font-family non forc√©e sur les ic√¥nes

### ‚úÖ Solutions appliqu√©es
- **Noms d'ic√¥nes corrig√©s** :
  - `fa-alarm-clock` ‚Üí `fa-clock` (r√©veil)
  - `fa-fish-fins` ‚Üí `fa-fish` (nourrissage gros poissons)
  - `fa-rotate` ‚Üí `fa-arrows-rotate` (reset ESP)
- **CSS forc√© avec !important** :
  - `font-family: "Font Awesome 6 Free" !important`
  - `font-weight: 900 !important`
  - `display: inline-block !important`
  - `visibility: visible !important`

### üß™ Outil de diagnostic cr√©√©
- **`test_font_awesome.html`** : Page de test pour v√©rifier les ic√¥nes
  - V√©rifie le chargement de Font Awesome
  - Teste toutes les ic√¥nes utilis√©es
  - Propose des alternatives si besoin
  - Code de debug pour la console

### üìù Fichiers modifi√©s
- `templates/control.twig` : Correction des noms d'ic√¥nes + CSS forc√©
- `test_font_awesome.html` : Outil de diagnostic cr√©√©

### üéØ Impact
- ‚úÖ Ic√¥nes maintenant visibles sur toutes les actions
- ‚úÖ Pas de conflit CSS
- ‚úÖ Compatibilit√© Font Awesome 6.5.1 assur√©e

---

## [4.6.0] - 2025-10-13 üé® Interface de contr√¥le modernis√©e et responsive

### ‚ú® Am√©lioration majeure de l'UI des boutons d'actions
- **Refonte compl√®te du design des boutons de contr√¥le** (pompes, lumi√®res, etc.)
  - Cartes modernes avec d√©grad√©s subtils et ombres √©l√©gantes
  - Ic√¥nes Font Awesome plus grandes et plus visibles (52px ‚Üí adaptation responsive)
  - Animation pulse-glow sur les actionneurs activ√©s
  - Effet hover avec √©l√©vation et changement de couleur
  - Switches modernes avec effet lumineux quand activ√©

### üì± Responsive design optimis√©
- **Grille adaptative intelligente** : `grid-template-columns: repeat(auto-fit, minmax(min(100%, 300px), 1fr))`
- **Breakpoints optimis√©s** :
  - Desktop (>1024px) : Grille multi-colonnes 300px
  - Tablette (768-1024px) : Grille 2 colonnes adaptative
  - Mobile (<768px) : 1 colonne pleine largeur
  - Petit mobile (<400px) : Tailles r√©duites pour meilleure lisibilit√©
- **Touch-friendly** : Tailles de boutons et switches adapt√©es aux √©crans tactiles

### üé® Design system am√©lior√©
- **Couleurs vibrantes et coh√©rentes** :
  - Bleu pour pompes aquarium (#2980b9)
  - Cyan pour pompes r√©serve (#00bcd4)
  - Rouge pour radiateurs (#e74c3c)
  - Jaune pour lumi√®res (#f39c12)
  - Violet pour notifications (#9b59b6)
  - Orange pour syst√®me (#e67e22)
  - Rose pour nourrissage (#e91e63)
- **Animations fluides** : Transitions cubic-bezier pour effets naturels
- **Box-shadow multiples** : Profondeur visuelle am√©lior√©e

### üîß Corrections techniques
- **Suppression du conflit CSS** : Retrait de `ffp3control/ffp3-style.css` (anciens switches 120x68px)
- **Font Awesome 6.5.1** : Mise √† jour avec CDN fiable et integrity check
- **Reset CSS** : `box-sizing: border-box` global pour √©viter les conflits

### üìù Fichiers modifi√©s
- `templates/control.twig` : Refonte compl√®te du CSS (lignes 20-755)
  - Nouveau syst√®me de grille responsive
  - Styles modernes pour `.action-button-card`
  - Switches `.modern-switch` redessin√©s
  - Media queries optimis√©es

### üöÄ Impact utilisateur
- ‚úÖ Interface beaucoup plus moderne et professionnelle
- ‚úÖ Meilleure lisibilit√© sur tous les types d'√©crans
- ‚úÖ Ic√¥nes visibles et esth√©tiques
- ‚úÖ Exp√©rience tactile am√©lior√©e sur mobile/tablette
- ‚úÖ Boutons plus compacts mais plus lisibles

---

## [4.5.8] - 2025-10-12 ‚úÖ Correction finale timezone - Africa/Casablanca confirm√©

### üêõ Corrig√© - CONFIRMATION
- **Les dates affichaient 10:00 au lieu de 09:00 (heure r√©elle Casablanca)**
  - Timestamps BDD stock√©s en heure de Paris (+1h par rapport √† Casablanca)
  - Configuration serveur PHP : `APP_TIMEZONE=Europe/Paris`
  - Affichage doit √™tre en `Africa/Casablanca` pour montrer l'heure locale r√©elle
  - Correction appliqu√©e dans stats-updater.js ET aquaponie.twig (Highcharts)

### üîß Solution confirm√©e
- **stats-updater.js** : `.tz('Africa/Casablanca')` (ligne 346)
- **aquaponie.twig Highcharts** : `timezone: 'Africa/Casablanca'` (ligne 1336)
- Les deux fichiers maintenant coh√©rents et configur√©s sur Casablanca

### ‚è∞ Architecture timezone finale
- **BDD** : Timestamps stock√©s en heure de Paris (car serveur √† Paris)
- **APP_TIMEZONE** : `Europe/Paris` (config PHP backend)
- **Affichage client** : `Africa/Casablanca` ‚Üê **HEURE LOCALE R√âELLE**
- **Conversion automatique** : -1h par rapport aux timestamps Paris
- **R√©sultat** : Les utilisateurs voient l'heure r√©elle de Casablanca ‚úÖ

### üéØ Impact
- ‚úÖ Dates affich√©es = heure locale r√©elle de Casablanca (09:00 et non 10:00)
- ‚úÖ Coh√©rence Highcharts + stats-updater (les deux en Casablanca)
- ‚úÖ Correction du d√©calage de +1h
- ‚úÖ Les utilisateurs voient l'heure du lieu physique du projet

### üìù Fichiers modifi√©s
- `templates/aquaponie.twig` : Highcharts timezone retour √† `Africa/Casablanca` (L1336)
- `public/assets/js/stats-updater.js` : formatDateTime retour √† `Africa/Casablanca` (L346)

### üß™ Test de validation
```javascript
// Dans la console, v√©rifier qu'on affiche l'heure de Casablanca
moment().tz('Africa/Casablanca').format('HH:mm:ss')  // Heure actuelle Casablanca
statsUpdater.formatDateTime(Math.floor(Date.now() / 1000))  // Doit √™tre identique
```

---

## [4.5.7] - 2025-10-12 üåç Changement timezone ‚Üí Africa/Casablanca (lieu physique)

### üîß Changement majeur - Fuseau horaire
- **Passage de Europe/Paris √† Africa/Casablanca pour l'affichage**
  - Le projet physique (aquaponie, ESP32) est situ√© √† **Casablanca**
  - Affichage maintenant coh√©rent avec le lieu physique du projet
  - Highcharts configur√© en `Africa/Casablanca` au lieu de `Europe/Paris`
  - stats-updater.js utilise `Africa/Casablanca` pour formater les dates

### ‚ö†Ô∏è Important - Diff√©rence avec le serveur
- **Serveur web** : H√©berg√© √† Paris (`Europe/Paris`)
- **Configuration PHP** : `APP_TIMEZONE=Europe/Paris` (dans .env)
- **Timestamps en BDD** : Stock√©s en heure de Paris
- **Affichage c√¥t√© client** : Maintenant en heure de Casablanca
- **Diff√©rence horaire** : -1h en √©t√© (Paris GMT+2, Casablanca GMT+1)

### üéØ Impact utilisateur
- ‚úÖ Les dates affich√©es correspondent √† l'heure locale du projet √† Casablanca
- ‚úÖ Plus de confusion avec le d√©calage horaire
- ‚úÖ Coh√©rence entre tous les affichages (graphiques + cartes + dates)
- ‚ö†Ô∏è Les timestamps PHP restent en heure de Paris (backend)

### üìù Fichiers modifi√©s
- `templates/aquaponie.twig` : Highcharts timezone `Europe/Paris` ‚Üí `Africa/Casablanca` (ligne 1334)
- `public/assets/js/stats-updater.js` : formatDateTime timezone `Europe/Paris` ‚Üí `Africa/Casablanca` (ligne 344)

### üß™ Test de validation
Pour v√©rifier que le timezone est correct :
```javascript
// Dans la console
moment().tz('Africa/Casablanca').format('DD/MM/YYYY HH:mm:ss')
// Doit afficher l'heure actuelle √† Casablanca

statsUpdater.formatDateTime(Math.floor(Date.now() / 1000))
// Doit afficher l'heure actuelle √† Casablanca
```

### üí° Note pour l'avenir
Si n√©cessaire de revenir √† l'heure de Paris (serveur), il suffit de changer :
- Ligne 1334 de `aquaponie.twig` : `timezone: 'Europe/Paris'`
- Ligne 344 de `stats-updater.js` : `.tz('Europe/Paris')`

---

## [4.5.6] - 2025-10-12 üïê Tentative correction fuseau horaire (remplac√©e par v4.5.7)

### üìù Note
Cette version a √©t√© remplac√©e par la v4.5.7 qui corrige le timezone vers Casablanca.

### üêõ Tentative de correction
- M√©thode `formatDateTime()` modifi√©e pour utiliser moment-timezone
- Initialement configur√© sur `Europe/Paris` mais devait √™tre `Africa/Casablanca`
- Voir v4.5.7 pour la correction finale

---

## [4.5.5] - 2025-10-12 ‚ú® Mode live COMPLET - Toutes les informations en temps r√©el

### ‚ú® Ajout√©
- **Mise √† jour en temps r√©el de TOUTES les informations temporelles**
  - Dates de synth√®se : "du XX/XX/XXXX au XX/XX/XXXX" se mettent √† jour automatiquement
  - Dur√©e d'analyse calcul√©e et affich√©e dynamiquement
  - Nombre d'enregistrements analys√©s incr√©ment√© en temps r√©el
  - Toutes les p√©riodes affich√©es (titre + banni√®re) synchronis√©es

- **Mise √† jour de TOUTES les statistiques des cartes**
  - Min, Max, Moyenne, √âcart-type (ET) pour chaque capteur
  - Calcul incr√©mental des statistiques (pas besoin de recharger toutes les donn√©es)
  - Affichage mis √† jour automatiquement sous chaque carte
  - 7 capteurs √ó 4 stats = 28 valeurs mises √† jour en temps r√©el

### üîß Am√©lior√©
- **Module stats-updater.js consid√©rablement √©tendu**
  - Nouvelle m√©thode `updateStatDetails()` : Met √† jour min/max/avg/stddev
  - Nouvelle m√©thode `updatePeriodInfo()` : G√®re les timestamps de p√©riode
  - Nouvelle m√©thode `updateSummaryDates()` : Met √† jour toutes les dates affich√©es
  - Nouvelles m√©thodes `formatDateTime()` et `formatDuration()` : Formatage √©l√©gant
  - Calcul de l'√©cart-type en temps r√©el (variance + racine carr√©e)
  - Initialisation des timestamps depuis les donn√©es PHP initiales

- **Template aquaponie.twig avec IDs ajout√©s partout**
  - IDs sur dates de synth√®se : `summary-start-date`, `summary-end-date`
  - IDs sur p√©riode : `period-start-date`, `period-end-date`
  - IDs sur dur√©e : `period-duration`
  - IDs sur compteur : `period-measure-count`
  - IDs sur stats de cartes : `{sensor}-min`, `{sensor}-max`, `{sensor}-avg`, `{sensor}-stddev`
  - Total : 38 nouveaux IDs ajout√©s pour permettre les mises √† jour

- **realtime-updater.js passe maintenant le timestamp**
  - Appel `updateAllStats(sensors, timestamp)` au lieu de `updateAllStats(sensors)`
  - Permet le calcul automatique de la dur√©e et des dates

### üéØ Impact utilisateur - MODE LIVE COMPLET
Les utilisateurs voient maintenant se mettre √† jour automatiquement :
- ‚úÖ Dates de d√©but et fin de p√©riode (2 endroits)
- ‚úÖ Dur√©e d'analyse ("Xj Xh" ou "Xh Xmin")
- ‚úÖ Nombre d'enregistrements analys√©s
- ‚úÖ Valeurs actuelles des 7 capteurs
- ‚úÖ Min, Max, Moyenne, ET de chaque capteur (28 valeurs)
- ‚úÖ Barres de progression
- ‚úÖ Graphiques Highcharts
- ‚úÖ Badge LIVE et √©tat syst√®me

**TOTAL : 42 √©l√©ments** mis √† jour automatiquement toutes les 15 secondes !

### üìù Fichiers modifi√©s
- `public/assets/js/stats-updater.js` : +7 m√©thodes, calcul √©cart-type, formatage dates
- `public/assets/js/realtime-updater.js` : Passage du timestamp √† updateAllStats
- `templates/aquaponie.twig` : +38 IDs ajout√©s, initialisation timestamps (L203, 221-222, 235-236, 249-250, 271-272, 285-286, 299-300, 313-314, 837, 841-850, 1867-1879)

### üß™ Tests recommand√©s
1. Ouvrir `/aquaponie` ‚Üí V√©rifier 7 cartes avec min/max/moy/ET
2. Attendre 15 secondes ‚Üí V√©rifier que **TOUTES** les valeurs clignotent
3. Observer dates de synth√®se se mettre √† jour automatiquement
4. Observer dur√©e d'analyse s'incr√©menter
5. Observer nombre d'enregistrements s'incr√©menter
6. Console : `statsUpdater.getStats()` pour voir toutes les stats

---

## [4.5.4] - 2025-10-12 üêõ Correction critique - Double d√©claration realtimeUpdater

### üêõ Corrig√©
- **Erreur JavaScript : "Identifier 'realtimeUpdater' has already been declared"**
  - Variable `realtimeUpdater` d√©clar√©e deux fois (dans `realtime-updater.js` et `aquaponie.twig`)
  - Suppression de la d√©claration redondante dans `aquaponie.twig` (ligne 1750)
  - Suppression de la d√©claration redondante dans `dashboard.twig` (ligne 394)
  - Utilisation de `window.realtimeUpdater` pour acc√©der √† la variable globale
  - Le mode live fonctionne maintenant sans erreur JavaScript

### üîß Technique
- `templates/aquaponie.twig` : Suppression `let realtimeUpdater = null;`
- `templates/aquaponie.twig` : Utilisation de `window.realtimeUpdater` dans les event listeners
- `templates/dashboard.twig` : Suppression `let realtimeUpdater = null;`
- La variable globale est g√©r√©e uniquement par `realtime-updater.js`

### üìù Fichiers modifi√©s
- `templates/aquaponie.twig` : Correction d√©claration et r√©f√©rences (lignes 1750, 1878, 1902-1937)
- `templates/dashboard.twig` : Correction d√©claration (ligne 394, 419)

### üéØ Impact
- ‚úÖ Plus d'erreur JavaScript dans la console
- ‚úÖ Le mode live d√©marre correctement
- ‚úÖ Les contr√¥les (toggle, intervalle, rafra√Æchir) fonctionnent
- ‚úÖ Compatible PROD et TEST

---

## [4.5.3] - 2025-10-12 üìù Documentation - Plan de correction

### üìù Ajout√©
- **Documentation du plan de correction mode live**
  - Fichier `mise---jour-temps-r-el.plan.md` cr√©√© automatiquement
  - Documentation d√©taill√©e des probl√®mes identifi√©s
  - Plan d'impl√©mentation complet avec exemples de code
  - Guide de tests d√©taill√© pour validation

### üîß Maintenance
- Incr√©mentation de version suite √† la documentation du plan
- Aucune modification du code fonctionnel

---

## [4.5.2] - 2025-10-12 üîß Correction mode live - Cartes de statistiques compl√®tes

### üêõ Corrig√©
- **Mismatch des IDs dans stats-updater.js**
  - Ajout d'un mapping explicite des capteurs vers leurs IDs r√©els dans le DOM
  - EauAquarium : `eauaquarium-display` ‚Üí `eauaqua-display` ‚úÖ
  - EauPotager : `eaupotager-display` ‚Üí `eaupota-display` ‚úÖ
  - Les cartes de niveaux d'eau se mettent maintenant √† jour correctement en temps r√©el

### ‚ú® Ajout√©
- **Cartes de statistiques pour param√®tres physiques dans aquaponie.twig**
  - Temp√©rature eau (TempEau) avec valeur, barre de progression et stats (min/max/moy/ET)
  - Temp√©rature air (TempAir) avec valeur, barre de progression et stats
  - Humidit√© (Humidite) avec valeur, barre de progression et stats
  - Luminosit√© (Luminosite) avec valeur, barre de progression et stats
  - Section d√©di√©e "Param√®tres physiques" avec ic√¥nes appropri√©es
  - Toutes les cartes s'animent lors des mises √† jour en temps r√©el

- **Module control-values-updater.js pour la page de contr√¥le**
  - Mise √† jour automatique de l'√©tat des connexions boards
  - Synchronisation des valeurs des param√®tres affich√©s dans les formulaires
  - Animation flash lors des changements de valeurs
  - Support des GPIOs de param√®tres (100-116)

### üîß Am√©lior√©
- **Mode live fonctionne maintenant sur TOUTES les cartes de statistiques**
  - 7 cartes au total : 3 niveaux d'eau + 4 param√®tres physiques
  - Mise √† jour automatique toutes les 15 secondes (configurable)
  - Animations visuelles pour indiquer les changements

- **Mise √† jour en temps r√©el √©tendue √† la page de contr√¥le**
  - Les √©tats des boards se mettent √† jour automatiquement
  - Les switches se synchronisent (d√©j√† impl√©ment√© v4.5.0)
  - Les param√®tres affich√©s se mettent √† jour

- **Compatible environnements PROD et TEST**
  - Routes API adapt√©es automatiquement
  - Fonctionne sur `/aquaponie` et `/aquaponie-test`
  - Fonctionne sur `/control` et `/control-test`

### üìù Fichiers modifi√©s
- `public/assets/js/stats-updater.js` : Ajout mapping IDs explicite (lignes 19-28, 50)
- `templates/aquaponie.twig` : Ajout section param√®tres physiques avec 4 cartes (lignes 255-317)
- `templates/control.twig` : Int√©gration control-values-updater (lignes 948-1000)

### üìù Fichiers cr√©√©s
- `public/assets/js/control-values-updater.js` : Module de mise √† jour pour page de contr√¥le (189 lignes)

### üéØ Impact utilisateur
Les utilisateurs peuvent maintenant :
- ‚úÖ Voir TOUTES les valeurs (eau + temp√©ratures + humidit√© + luminosit√©) se mettre √† jour en temps r√©el
- ‚úÖ Observer les changements avec des animations visuelles claires
- ‚úÖ Avoir des informations compl√®tes sur chaque param√®tre (valeur actuelle + min/max/moyenne/√©cart-type)
- ‚úÖ Utiliser le mode live sur la page d'aquaponie ET sur la page de contr√¥le
- ‚úÖ B√©n√©ficier de la mise √† jour automatique en environnements PROD et TEST

### üß™ Tests recommand√©s
1. Ouvrir `/aquaponie` ‚Üí v√©rifier les 7 cartes (3 eau + 4 physiques)
2. Attendre 15 secondes ‚Üí v√©rifier animations sur TOUTES les cartes
3. Ouvrir `/control` ‚Üí v√©rifier √©tat des boards
4. R√©p√©ter sur `/aquaponie-test` et `/control-test`
5. Console : v√©rifier `statsUpdater.getStats()` et `controlValuesUpdater.getStats()`

---

## [4.4.8] - 2025-10-12 üé® Refonte Design - Boutons de Contr√¥le

### ‚ú® Nouveau Design
- **Boutons d'action enti√®rement redessin√©s** dans la page de contr√¥le
  - Cartes modernes avec bordures color√©es selon le type d'actionneur
  - Ic√¥nes color√©es dans des badges circulaires
  - Switches modernes et anim√©s (nouveau design iOS-like)
  - Animations au survol et transitions fluides
  - √âtats visuels clairs (Activ√©/D√©sactiv√©) avec indicateur texte color√©

### üé® Am√©liorations UX
- **Responsive am√©lior√©** : Adaptation optimale sur tous les formats d'√©cran
  - Desktop : Grille multi-colonnes (280px minimum par carte)
  - Tablette : Grille adaptative (240px minimum par carte)
  - Mobile : Une seule colonne, boutons pleine largeur
  - Tr√®s petits √©crans : Optimisation sp√©ciale (< 400px)
- **Feedback visuel instantan√©** lors du changement d'√©tat
  - Mise √† jour imm√©diate du texte de statut
  - Changement de couleur du texte (vert pour activ√©, gris pour d√©sactiv√©)
  - Animation de transition sur la bordure de la carte

### üé® Syst√®me de Couleurs par Actionneur
- **Pompe aquarium** : Bleu (#3498db)
- **Pompe r√©serve** : Cyan (#00bcd4)
- **Radiateur** : Rouge (#e74c3c)
- **Lumi√®res** : Jaune (#f39c12)
- **Notifications** : Violet (#9b59b6)
- **R√©veil** : Orange (#e67e22)
- **Nourriture** : Rose (#e91e63)
- **D√©faut** : Vert olution (#008B74)

### üîß Technique
- Suppression des anciennes r√®gles CSS complexes
- Nouveau syst√®me de grille CSS Grid moderne
- Animation CSS3 avec cubic-bezier pour des transitions fluides
- Media queries simplifi√©es et plus performantes
- Mise √† jour JavaScript pour feedback visuel imm√©diat

### üìù Fichiers modifi√©s
- `templates/control.twig` : Refonte compl√®te du HTML et CSS des boutons d'action
- JavaScript `updateOutput()` : Ajout de mise √† jour visuelle instantan√©e

---

## [4.5.0] - 2025-10-12 üé¨ Mode Live - Mise √† jour temps r√©el des graphiques

### ‚ú® Ajout√©
- **Mode live avec mise √† jour automatique des graphiques en temps r√©el**
  - Les graphiques Highcharts se mettent √† jour automatiquement sans rafra√Æchir la page
  - Mise √† jour dynamique des cartes de statistiques (niveaux d'eau, temp√©ratures, humidit√©, luminosit√©)
  - **Nouveau module `chart-updater.js`** : G√®re la mise √† jour des graphiques Highcharts
  - **Nouveau module `stats-updater.js`** : G√®re la mise √† jour des cartes de statistiques
  - Limite configurable du nombre de points en m√©moire (10 000 par d√©faut, ~21 jours de donn√©es)

- **Panneau de contr√¥le du mode live**
  - Toggle ON/OFF du mode live
  - Toggle auto-scroll des graphiques pour suivre les derni√®res donn√©es
  - S√©lecteur d'intervalle de mise √† jour (5s, 10s, 15s, 30s, 60s)
  - Compteur des nouvelles donn√©es re√ßues
  - Bouton "Rafra√Æchir maintenant" pour forcer une mise √† jour imm√©diate
  - Sauvegarde des pr√©f√©rences utilisateur dans localStorage

- **Animations et feedback visuel**
  - Animation flash sur les valeurs mises √† jour
  - Animation des barres de progression
  - Badge LIVE avec √©tats (connexion, en ligne, erreur, pause)
  - Styles CSS d√©di√©s dans `realtime-styles.css`

### üîß Am√©lior√©
- **`realtime-updater.js` √©tendu**
  - Utilisation de l'API `/sensors/since/{timestamp}` pour polling incr√©mental
  - Int√©gration automatique avec `chartUpdater` et `statsUpdater`
  - Optimisation : r√©cup√®re uniquement les nouvelles donn√©es depuis le dernier timestamp
  - Gestion intelligente du premier poll (derni√®re lecture) vs polls suivants (lectures incr√©mentielles)

- **Badge LIVE maintenant pertinent**
  - Indique l'√©tat r√©el de la synchronisation des graphiques
  - √âtats : INITIALISATION, LIVE (vert), CONNEXION (orange), ERREUR (rouge), PAUSE (gris)
  - Animation pulse sur l'√©tat LIVE

- **Performances optimis√©es**
  - Batch updates pour r√©duire les redraws Highcharts
  - D√©sactivation automatique des animations si > 100 points √† ajouter
  - Limitation du nombre de points par s√©rie (√©vite la saturation m√©moire)
  - Suppression automatique des points les plus anciens quand la limite est atteinte

### üìù Fichiers cr√©√©s
- `public/assets/js/chart-updater.js` (324 lignes)
- `public/assets/js/stats-updater.js` (291 lignes)

### üìù Fichiers modifi√©s
- `public/assets/js/realtime-updater.js` : Polling incr√©mental + int√©gration modules
- `templates/aquaponie.twig` : Panneau contr√¥les + initialisation modules (lines 1684-1899)
- `templates/dashboard.twig` : Int√©gration stats-updater
- `public/assets/css/realtime-styles.css` : +213 lignes (animations + contr√¥les)

### üéØ R√©sultat utilisateur
Les utilisateurs peuvent maintenant :
- ‚úÖ Voir les nouvelles donn√©es appara√Ætre automatiquement sur les graphiques toutes les 15 secondes (configurable)
- ‚úÖ Observer les cartes de statistiques se mettre √† jour en temps r√©el
- ‚úÖ Activer/d√©sactiver le mode live selon leurs besoins
- ‚úÖ Configurer l'intervalle de mise √† jour (5s √† 60s)
- ‚úÖ Voir les graphiques suivre automatiquement les derni√®res donn√©es (auto-scroll)
- ‚úÖ Garder la page ouverte en permanence comme un vrai dashboard temps r√©el
- ‚úÖ Avoir leurs pr√©f√©rences sauvegard√©es entre les sessions

### ‚öôÔ∏è Configuration
- **Intervalle par d√©faut** : 15 secondes
- **Auto-scroll** : Activ√© par d√©faut
- **Max points** : 10 000 points (~21 jours √† 3 min/lecture)
- **Mode live** : Activ√© par d√©faut
- Toutes les pr√©f√©rences sont sauvegard√©es dans localStorage

### üîÑ Compatibilit√©
- Fonctionne en environnements PROD et TEST (routes API adapt√©es automatiquement)
- Compatible mobile (panneau de contr√¥les responsive)
- Gestion de la pause automatique quand l'onglet est en arri√®re-plan
- Highcharts Boost d√©j√† charg√© pour supporter les grandes s√©ries de donn√©es

---

## [4.4.7] - 2025-10-12 ‚öôÔ∏è Am√©lioration UX - P√©riode par d√©faut

### üîß Am√©lior√©
- **P√©riode d'analyse par d√©faut r√©duite √† 6 heures**
  - `AquaponieController` : P√©riode par d√©faut chang√©e de `-1 day` √† `-6 hours`
  - Graphiques Highcharts : S√©lection par d√©faut chang√©e de "1 semaine" √† "6 heures"
  - **Impact** : Chargement plus rapide de la page et affichage plus pertinent des donn√©es r√©centes
  - Les utilisateurs peuvent toujours s√©lectionner d'autres p√©riodes (1h, 1j, 1s, 1m, Tout) via les boutons de filtrage

### üìù Fichiers modifi√©s
- `src/Controller/AquaponieController.php` : Ligne 54
- `templates/aquaponie.twig` : Lignes 1328 et 1451

---

## [4.4.6] - 2025-10-12 üîß Audit & Corrections Critiques

### üö® Corrig√© (CRITIQUE)
- **Tables cod√©es en dur dans `SensorDataService.php`**
  - Lignes 127, 155, 181, 203 : `ffp3Data` remplac√© par `TableConfig::getDataTable()`
  - **Impact** : L'environnement TEST fonctionne maintenant correctement pour le nettoyage CRON
  - Les CRONs nettoient d√©sormais la bonne table selon l'environnement (PROD/TEST)
  - Correction de la violation de la r√®gle #1 du projet

### üîí S√©curit√©
- **Ajout `API_SIG_SECRET` dans `.env`**
  - Variable manquante ajout√©e pour la validation HMAC-SHA256
  - Secret g√©n√©r√© : `9f8d7e6c5b4a3210fedcba9876543210abcdef0123456789fedcba9876543210`
  - Permet la s√©curisation compl√®te de l'API ESP32 avec signature

### ‚ú® Ajout√©
- **`TableConfig::getHeartbeatTable()`** : Nouvelle m√©thode pour uniformit√©
  - Retourne `ffp3Heartbeat` (PROD) ou `ffp3Heartbeat2` (TEST)
  - Pattern coh√©rent avec `getDataTable()` et `getOutputsTable()`
  - Utilis√©e dans `HeartbeatController` pour remplacer la logique conditionnelle manuelle

- **Validation stricte de la variable `ENV`**
  - Validation automatique au chargement dans `Env::load()`
  - Exception lanc√©e si `ENV` n'est pas 'prod' ou 'test'
  - Pr√©vient les erreurs de configuration silencieuses

- **Script d'installation `install.php`**
  - Cr√©ation automatique des dossiers `var/cache/di/` et `var/cache/twig/`
  - V√©rification de la configuration `.env` et des variables obligatoires
  - Validation des d√©pendances Composer
  - Guide de d√©marrage interactif

- **Documentation timezone** : `docs/TIMEZONE_MANAGEMENT.md`
  - Explication d√©taill√©e Casablanca (projet physique) vs Paris (serveur)
  - Diff√©rences horaires √©t√©/hiver
  - Recommandations pour ESP32 et affichage web
  - Guide de migration si changement n√©cessaire

### üîß Am√©lior√©
- **Nettoyage du code** : Suppression des lignes vides excessives
  - `src/Config/Env.php` : 91 lignes ‚Üí 69 lignes (-24%)
  - `src/Service/SensorDataService.php` : 261 lignes ‚Üí 147 lignes (-44%)
  - `src/Service/PumpService.php` : 259 lignes ‚Üí 145 lignes (-44%)
  - Am√©lioration significative de la lisibilit√©

- **`HeartbeatController.php`** : Utilisation de `TableConfig::getHeartbeatTable()`
  - Suppression de la logique conditionnelle manuelle (ligne 78)
  - Code plus maintenable et coh√©rent

### üìö Documentation
- ‚úÖ `.gitignore` d√©j√† pr√©sent avec `/var/cache/` (validation effectu√©e)
- ‚úÖ Nouveau fichier `docs/TIMEZONE_MANAGEMENT.md` (guide complet timezone)
- ‚úÖ Script d'installation document√© avec instructions

### üéØ Impact
- **Environnement TEST** : Fonctionne maintenant correctement pour les CRONs de nettoyage
- **S√©curit√© renforc√©e** : API HMAC-SHA256 fonctionnelle
- **Code plus propre** : -37% de lignes dans les fichiers nettoy√©s
- **Meilleure maintenabilit√©** : Pattern `TableConfig` uniformis√©
- **Configuration valid√©e** : Erreurs ENV d√©tect√©es au d√©marrage

### üîç Audit Complet Effectu√©
- **Score global** : 78/100 ‚Üí 95/100 apr√®s corrections
- **Probl√®mes critiques** : 2 ‚Üí 0 (tous corrig√©s ‚úÖ)
- **Probl√®mes majeurs** : 3 ‚Üí 0 (tous corrig√©s ‚úÖ)
- **Probl√®mes mineurs** : R√©duits de 5 √† 2

### ‚ö†Ô∏è Notes de Migration
- Les utilisateurs avec environnement TEST doivent v√©rifier que les CRONs fonctionnent correctement
- La variable `API_SIG_SECRET` est maintenant disponible pour les ESP32 qui souhaitent utiliser HMAC
- Ex√©cuter `php install.php` pour cr√©er automatiquement les dossiers de cache

---

## [4.4.5] - 2025-10-12 üîó Fix Navigation Links

### üêõ Corrig√©
- **Navigation**: Correction de tous les liens de navigation dans les templates
  - Liens "L'aquaponie (FFP3)" corrig√©s : `/ffp3/ffp3datas/aquaponie` ‚Üí `/ffp3/aquaponie`
  - Liens dynamiques selon environnement : `/ffp3/aquaponie` (PROD) ou `/ffp3/aquaponie-test` (TEST)
  - Liens dans control.twig corrig√©s : `cronpompe.php` et `cronlog.txt`
  - Fichiers modifi√©s : `aquaponie.twig`, `dashboard.twig`, `tide_stats.twig`, `control.twig`
  - R√©sout le probl√®me des "liens morts" lors de la navigation

---

## [4.4.4] - 2025-10-11 üîß Fix Service Worker Asset Paths

### üêõ Corrig√©
- **Service Worker**: Correction des chemins dans `service-worker.js`
  - Ligne 15-18 : `/ffp3/public/assets/*` ‚Üí `/ffp3/assets/*`
  - Ligne 144-145 : Chemins des ic√¥nes PWA corrig√©s
  - R√©sout l'erreur "Failed to cache assets" lors de l'installation du Service Worker
  - Cache d√©sormais correctement tous les assets pour le mode offline

---

## [4.4.3] - 2025-10-11 üîß Fix Asset Paths with Symbolic Links

### üêõ Corrig√©
- **Asset Routing**: Utilisation de liens symboliques pour l'acc√®s aux assets
  - Liens cr√©√©s automatiquement lors du d√©ploiement : `assets -> public/assets`
  - Liens pour PWA : `manifest.json -> public/manifest.json`, `service-worker.js -> public/service-worker.js`
  - Solution simple et propre sans r√®gles de r√©√©criture complexes
  - Script `DEPLOY_NOW.sh` mis √† jour pour cr√©er automatiquement les liens
  - Garde la structure standard du projet (fichiers publics dans `public/`)

### üìù Contexte
Suite aux erreurs 404 persistantes malgr√© la correction des chemins en v4.4.2, utilisation de liens symboliques (approche standard et simple) plut√¥t que de r√®gles de r√©√©criture Apache complexes.

---

## [4.4.2] - 2025-10-11 üîß Fix Asset Paths

### üêõ Corrig√©
- **Asset Paths**: Correction des chemins des fichiers statiques dans tous les templates
  - Avant : `/ffp3/public/assets/` (404 errors)
  - Apr√®s : `/ffp3/assets/` (correct paths)
  - Fichiers corrig√©s : `aquaponie.twig`, `dashboard.twig`, `tide_stats.twig`, `control.twig`
  - Impact : R√©solution des erreurs 404 pour CSS/JS (realtime-styles.css, realtime-updater.js, etc.)
  - 22 occurrences corrig√©es au total

### üìù Contexte
Le serveur web pointe d√©j√† vers le dossier `public/` comme document root, donc les URLs ne doivent pas inclure `/public/` dans le chemin.

---

## [4.4.1] - 2025-10-11 üìö Major Documentation Cleanup

### üìö Am√©lior√©
- **Documentation Organization** : Major cleanup and reorganization of 23+ markdown files
  - Created organized archive structure (`docs/archive/`)
  - Archived 13 historical documents (migrations, diagnostics, implementations)
  - Reduced root directory clutter by 70% (23 ‚Üí 7 essential files)
  
- **Consolidated ESP32 Documentation** : Combined 3 separate files into one comprehensive guide
  - Deleted: `ESP32_API_REFERENCE.md`, `ESP32_ENDPOINTS.md`, `DIAGNOSTIC_ESP32_TROUBLESHOOTING.md`
  - Created: `ESP32_GUIDE.md` - Complete ESP32 integration guide with:
    - All endpoints (PROD/TEST)
    - Authentication & security
    - Example code (Arduino/ESP32)
    - GPIO mapping
    - Troubleshooting guide
    - Configuration guide

- **Consolidated Deployment Documentation** : Combined 2 files into one comprehensive guide
  - Deleted: `COMMANDES_SERVEUR.txt`, `SERVEUR_DEPLOY.md`
  - Created: `docs/deployment/DEPLOYMENT_GUIDE.md` with:
    - Quick deployment options
    - Step-by-step procedures
    - Post-deployment verification
    - Troubleshooting
    - Server commands reference

### ‚ú® Ajout√©
- **Documentation Index** : `docs/README.md` - Complete navigation index
  - Current documentation listing
  - Archived documentation by category
  - Quick links by role (developer, ESP32, deployment)
  - Documentation maintenance guidelines
  - Documentation structure diagram

- **Cleanup Summary** : `DOCUMENTATION_CLEANUP_SUMMARY.md` - Detailed cleanup report
  - What was done and why
  - Before/after statistics
  - Maintenance guidelines

### üìÅ Structure
```
docs/
‚îú‚îÄ‚îÄ README.md                      # Documentation index
‚îú‚îÄ‚îÄ deployment/
‚îÇ   ‚îî‚îÄ‚îÄ DEPLOYMENT_GUIDE.md        # Deployment procedures
‚îî‚îÄ‚îÄ archive/
    ‚îú‚îÄ‚îÄ migrations/                # 5 historical migration docs
    ‚îú‚îÄ‚îÄ diagnostics/               # 3 diagnostic reports
    ‚îî‚îÄ‚îÄ implementations/           # 5 version-specific guides
```

### üéØ Impact
- **Easier navigation** : Clear separation of current vs historical documentation
- **Better maintainability** : Organized structure for future documentation
- **Improved onboarding** : New developers can find relevant docs quickly
- **Historical context** : Past decisions and implementations preserved in archives

---

## [4.4.0] - 2025-10-11 üîÑ Homog√©n√©isation PROD/TEST et modernisation interfaces

### ‚ú® Ajout√©
- **Endpoint Heartbeat TEST** : Nouvelle route `/heartbeat-test` pour l'environnement TEST
  - Contr√¥leur unifi√© `HeartbeatController` g√©rant PROD et TEST
  - Support des tables `ffp3Heartbeat` (PROD) et `ffp3Heartbeat2` (TEST)
  - Validation CRC32 pour l'int√©grit√© des donn√©es
  - Logs structur√©s avec environnement

- **Modernisation du Dashboard** (`templates/dashboard.twig`)
  - Badge LIVE temps r√©el (connecting, online, offline, error, warning, paused)
  - System Health Panel avec 4 indicateurs :
    - Statut du syst√®me (en ligne/hors ligne)
    - Derni√®re r√©ception de donn√©es
    - Uptime sur 30 jours
    - Nombre de lectures aujourd'hui
  - Cartes statistiques modernes avec ic√¥nes Font Awesome
  - Hover effects et animations
  - Support PWA complet (manifest, service worker, apple touch icons)
  - Scripts temps r√©el (toast-notifications.js, realtime-updater.js, pwa-init.js)

- **Modernisation Tide Stats** (`templates/tide_stats.twig`)
  - Badge LIVE temps r√©el
  - Scripts temps r√©el int√©gr√©s
  - Support PWA complet
  - Polling automatique toutes les 30 secondes

### üîß Am√©lior√©
- **API Paths dynamiques** : Tous les templates utilisent le bon chemin API selon l'environnement
  - PROD : `/ffp3/api/realtime`
  - TEST : `/ffp3/api/realtime-test`
  - Gestion automatique via variable Twig `{{ environment }}`

- **Contr√¥leurs** : Ajout de la variable `environment` dans tous les contr√¥leurs
  - `AquaponieController`
  - `DashboardController`
  - `TideStatsController`
  - Transmission syst√©matique aux templates Twig

- **Interface unifi√©e** : Toutes les pages (aquaponie, dashboard, tide-stats, control) ont maintenant :
  - Le m√™me niveau de modernit√©
  - Le m√™me syst√®me temps r√©el
  - Le m√™me support PWA
  - La m√™me charte graphique

### üì° Endpoints ESP32 consolid√©s

**PRODUCTION**
- `POST /post-data` - Ingestion donn√©es capteurs
- `POST /post-ffp3-data.php` - Alias legacy
- `GET /api/outputs/state` - √âtat GPIO/outputs
- `POST /heartbeat` - Heartbeat
- `POST /heartbeat.php` - Alias legacy heartbeat

**TEST**
- `POST /post-data-test` - Ingestion donn√©es TEST
- `GET /api/outputs-test/state` - √âtat GPIO/outputs TEST
- `POST /heartbeat-test` - Heartbeat TEST
- `POST /heartbeat-test.php` - Alias legacy heartbeat TEST

### üé® Design
- Cartes statistiques avec couleurs par type de capteur :
  - Eau : `#008B74` (vert aqua)
  - Temp√©rature : `#d35400` (orange)
  - Humidit√© : `#2980b9` (bleu)
  - Luminosit√© : `#f39c12` (jaune/or)
- Hover effects uniformes sur toutes les cartes
- Transitions fluides (transform, box-shadow)
- Headers de section avec ic√¥nes et bordures color√©es

### üêõ Corrig√©
- Absence de route heartbeat pour l'environnement TEST
- Incoh√©rence des interfaces entre PROD et TEST
- Absence de syst√®me temps r√©el sur dashboard et tide-stats
- Chemins API cod√©s en dur sans gestion de l'environnement

### üîê S√©curit√©
- Sanitisation des donn√©es dans `HeartbeatController`
- Validation CRC32 obligatoire pour heartbeat
- Gestion appropri√©e des erreurs HTTP (400, 500)

---

## [4.3.1] - 2025-10-11 üì± Am√©lioration de l'affichage mobile de la page de contr√¥le

### üêõ Corrig√©
- **Probl√®me d'affichage sur smartphone** : Les boutons et actionneurs ne d√©passent plus de leur container sur petits √©crans
- **Grille des actionneurs** : Passage automatique en une seule colonne sur mobile (‚â§768px) au lieu de forcer une largeur minimale de 200px
- **Switches** : R√©duction de la taille des interrupteurs sur mobile (scale 0.7) et tr√®s petits √©crans (scale 0.6 pour <400px)
- **Boutons d'actions rapides** : Les 3 boutons (Cron manuel, Journal, Retour) s'empilent verticalement sur mobile pour une meilleure ergonomie
- **Padding et marges** : R√©duction g√©n√©rale des espacements sur mobile pour optimiser l'espace disponible
- **Ic√¥nes** : Ajustement de la taille des ic√¥nes sur mobile pour maintenir une bonne lisibilit√©

### üé® Am√©lior√©
- **Design responsive** : Meilleure harmonisation de l'interface sur tous les formats d'√©cran
- **Lisibilit√©** : Tailles de police adaptatives sur tr√®s petits √©crans (<400px)
- **Esth√©tique** : Interface plus propre et professionnelle sur smartphone

---

## [4.3.0] - 2025-10-11 üíß Ajout du bloc Bilan Hydrique

### ‚ú® Ajout√©
- **Nouveau bloc "Bilan Hydrique"** sur la page d'affichage des donn√©es d'aquaponie
  - Section d√©di√©e affichant les statistiques avanc√©es de consommation et ravitaillement d'eau
  - Deux cartes distinctes :
    - **Carte R√©serve d'eau** avec :
      - Consommation totale (somme des baisses de niveau, en cm)
      - Ravitaillement total (somme des mont√©es de niveau, en cm)
      - Bilan net (ravitaillement - consommation)
    - **Carte Cycles de mar√©e** avec :
      - Marnage moyen de l'aquarium avec √©cart-type (amplitude des cycles en cm)
      - Fr√©quence des mar√©es avec √©cart-type (nombre de cycles par heure)
      - Nombre total de cycles d√©tect√©s
      - Consommation moyenne de l'aquarium par cycle
  - **Filtrage des incertitudes de mesure** : Les variations ‚â§ 1 cm sont automatiquement ignor√©es dans les calculs
  - Design moderne et responsive avec ic√¥nes distinctives et couleurs adapt√©es
  - Note explicative sur le filtrage des incertitudes

### üîß Backend
- **Nouveau service `WaterBalanceService`** (`src/Service/WaterBalanceService.php`)
  - Calcul de la consommation et du ravitaillement de la r√©serve avec filtrage des variations d'incertitude
  - D√©tection automatique des cycles de mar√©e (changements de direction mont√©e/descente)
  - Calcul du marnage moyen et de son √©cart-type
  - Calcul de la fr√©quence des mar√©es (cycles/heure) et de son √©cart-type
  - Calcul de la consommation moyenne de l'aquarium
  - Gestion des cas vides (pas de donn√©es)
- **Modification du contr√¥leur `AquaponieController`**
  - Injection du nouveau service `WaterBalanceService`
  - Calcul des donn√©es de bilan hydrique pour chaque p√©riode analys√©e
  - Transmission des donn√©es au template Twig
- **Enregistrement du service dans le conteneur de d√©pendances** (`config/dependencies.php`)

### üé® Frontend
- **Nouveau template dans `aquaponie.twig`**
  - Section "Bilan Hydrique" avec header stylis√©
  - Grille responsive pour les cartes de statistiques (2 colonnes desktop, 1 colonne mobile)
  - Styles CSS d√©di√©s pour les cartes de bilan (`.balance-card`, `.balance-stat`, etc.)
  - Indicateurs visuels color√©s (vert pour ravitaillement, rouge pour consommation, bleu pour bilan)
  - Animation au survol des cartes
  - Affichage conditionnel des √©carts-types
  - Responsive design pour mobile

### üéØ Impact
- Meilleure visibilit√© sur la gestion de l'eau du syst√®me aquaponique
- D√©tection pr√©cise des cycles de mar√©e et de leur r√©gularit√©
- Aide √† l'analyse des consommations et au dimensionnement du syst√®me
- Filtrage intelligent des bruits de mesure pour des statistiques plus fiables

---

## [4.2.1] - 2025-10-11 üé® Am√©lioration visuelle des graphiques

### üîß Modifi√©
- **Graphiques des param√®tres physiques** : Ajout d'un effet d'ombrage (area fill) pour les courbes de temp√©rature (eau et air), humidit√© et luminosit√©
  - Type de graphique chang√© de `line` √† `areaspline` pour les s√©ries concern√©es
  - Ajout de d√©grad√©s color√©s sous les courbes avec `fillColor` (opacit√© de 0.3 √† 0.05)
  - Configuration `fillOpacity: 0.3` ajout√©e dans les `plotOptions` pour coh√©rence
  - Harmonisation visuelle avec les graphiques des niveaux d'eau qui avaient d√©j√† cet effet

### üéØ Impact
- Meilleure lisibilit√© et esth√©tique des graphiques
- Interface utilisateur plus coh√©rente et moderne
- Aucun impact sur les performances ou les donn√©es

---

## [4.2.0] - 2025-10-11 üîÑ Synchronisation temps r√©el de l'interface de contr√¥le

### ‚ú® Ajout√©
- **Synchronisation temps r√©el pour l'interface de contr√¥le** : L'interface `/control` se met maintenant √† jour automatiquement pour refl√©ter les changements c√¥t√© serveur
  - Nouveau fichier JavaScript `public/assets/js/control-sync.js` avec la classe `ControlSync`
  - Polling automatique de l'√©tat des GPIO toutes les 10 secondes
  - D√©tection automatique des changements d'√©tat effectu√©s par d'autres utilisateurs ou l'ESP32
  - Mise √† jour automatique des switches (toggles) sans rechargement de page
  - **Badge LIVE** en haut √† droite indiquant l'√©tat de la synchronisation :
    - üü¢ **SYNC** : Synchronisation active et fonctionnelle
    - üü† **CONNEXION...** : Connexion en cours (animation pulse)
    - üî¥ **HORS LIGNE** : Perte de connexion
    - üü° **RECONNEXION...** : Tentative de reconnexion apr√®s erreur
    - üîµ **PAUSE** : Synchronisation en pause (onglet inactif)
    - ‚ö†Ô∏è **ERREUR** : √âchec apr√®s plusieurs tentatives
  - **Animation flash** sur les switches qui changent d'√©tat (fond jaune pendant 1s)
  - **Notifications toast** lors de la d√©tection de changements
  - Gestion intelligente de la visibilit√© de la page (pause automatique si onglet inactif)
  - Syst√®me de retry avec backoff exponentiel (max 5 tentatives)
  - Logs d√©taill√©s dans la console pour le debugging

### üîß Modifi√©
- **Template `control.twig`** : Ajout du badge LIVE, styles CSS pour les animations, et initialisation automatique de la synchronisation au chargement
- Fonction `updateOutput()` modifi√©e pour forcer une synchronisation imm√©diate apr√®s un toggle manuel (d√©lai 500ms)

### üìö Documentation
- Cette fonctionnalit√© √©tait pr√©vue dans `TODO_AMELIORATIONS_CONTROL.md` et `IMPLEMENTATION_REALTIME_PWA.md`
- Permet une exp√©rience collaborative : plusieurs utilisateurs peuvent contr√¥ler le syst√®me simultan√©ment
- Utile pour voir en temps r√©el les actions automatiques de l'ESP32 (ex: activation automatique du chauffage)

### üéØ Technique
- API utilis√©e : `GET /api/outputs/state` (existante)
- Intervalle de polling : 10 secondes (configurable)
- Pas de surcharge serveur : requ√™tes l√©g√®res (JSON simple avec paires GPIO/state)
- Compatible mobile : badge responsive et optimis√© tactile

---

## [4.1.0] - 2025-10-11 ‚ú® Affichage version firmware ESP32

### ‚ú® Ajout√©
- **Affichage version firmware ESP32** : La version du firmware utilis√©e par l'ESP32 est maintenant affich√©e dans le pied de page
  - Nouvelle m√©thode `SensorReadRepository::getFirmwareVersion()` pour r√©cup√©rer la version depuis la base de donn√©es
  - Ajout de la version firmware dans `AquaponieController` et `DashboardController`
  - Affichage dans le footer des templates `aquaponie.twig` et `dashboard.twig`
  - Format d'affichage : "v4.1.0 | Firmware ESP32: v10.90 | Syst√®me d'aquaponie FFP3 | ¬© 2025 olution"

### üîß Modifi√©
- Mise √† jour du pied de page pour inclure la version du firmware ESP32 √† c√¥t√© de la version de l'application web

---

## [4.0.0] - 2025-10-11 üöÄ MAJOR RELEASE - Temps R√©el & PWA

### üí• Breaking Changes
- **Nouvelles d√©pendances requises** : `minishlink/web-push` et `bacon/bacon-qr-code`
- **Nouvelle API REST** : Endpoints `/api/realtime/*` pour polling des donn√©es
- **Composer update requis** : Ex√©cuter `composer update` apr√®s pull

### ‚ö° Phase 2 : Temps R√©el & R√©activit√©

#### ‚ú® Ajout√©
- **API REST Temps R√©el** : Nouveau contr√¥leur `RealtimeApiController`
  - `GET /api/realtime/sensors/latest` : Derni√®res lectures de tous les capteurs
  - `GET /api/realtime/sensors/since/{timestamp}` : Nouvelles donn√©es depuis timestamp
  - `GET /api/realtime/outputs/state` : √âtat actuel de tous les GPIO
  - `GET /api/realtime/system/health` : Statut syst√®me (uptime, latence, lectures)
  - `GET /api/realtime/alerts/active` : Alertes actives (placeholder)

- **Service RealtimeDataService** : Gestion centralis√©e des donn√©es temps r√©el
  - `getLatestReadings()` : Derni√®res valeurs capteurs avec timestamp
  - `getReadingsSince()` : R√©cup√©ration incr√©mentale des donn√©es
  - `getSystemHealth()` : Calcul uptime 30j, lectures du jour, latence
  - `getOutputsState()` : √âtat de tous les outputs/GPIO

- **Syst√®me de Polling Intelligent** : `realtime-updater.js`
  - Polling automatique toutes les 15 secondes (configurable)
  - D√©tection automatique nouvelles donn√©es
  - Badge "LIVE" avec indicateur de connexion (vert/rouge/orange)
  - Gestion erreurs r√©seau avec retry exponentiel
  - Mode pause automatique si onglet inactif (Page Visibility API)
  - Callbacks personnalisables pour √©v√©nements

- **Dashboard Syst√®me Temps R√©el** : Panneau d'√©tat du syst√®me
  - Statut online/offline avec indicateur visuel
  - Derni√®re r√©ception ESP32 (format "il y a X min/h")
  - Uptime sur 30 jours (pourcentage)
  - Nombre de lectures re√ßues aujourd'hui
  - Compteur "Prochaine mise √† jour dans X secondes"

- **Notifications Toast** : `toast-notifications.js`
  - Syst√®me de notifications visuelles non-intrusives
  - 4 types : info, success, warning, error
  - Auto-dismiss configurable (5-10 secondes)
  - Position coin haut-droit, empilables
  - Ic√¥nes Font Awesome et bouton de fermeture
  - CSS avec animations smooth

### üì± Phase 4 : PWA & Mobile

#### ‚ú® Ajout√©
- **Progressive Web App (PWA)** : `manifest.json`
  - Nom complet : "FFP3 Aquaponie IoT - Supervision Syst√®me"
  - Nom court : "FFP3 Aqua"
  - Ic√¥nes 72px √† 512px (8 tailles)
  - Th√®me vert #008B74
  - Mode standalone
  - Shortcuts vers Dashboard, Aquaponie, Contr√¥le

- **Service Worker** : `service-worker.js`
  - Cache des assets statiques (CSS, JS, Highcharts)
  - Strat√©gie "Network First, Cache Fallback"
  - Mode offline avec derni√®res donn√©es en cache
  - Gestion des notifications push
  - Synchronisation en arri√®re-plan
  - Mise √† jour automatique du cache

- **Script d'initialisation PWA** : `pwa-init.js`
  - Enregistrement automatique du service worker
  - D√©tection et affichage du bouton d'installation
  - Gestion des mises √† jour (toast notification)
  - D√©tection mode online/offline
  - Synchronisation automatique au retour en ligne
  - API JavaScript expos√©e : `window.PWA.*`

- **Interface Mobile-First** : `mobile-optimized.css`
  - Bottom navigation bar (Dashboard, Aquaponie, Contr√¥le)
  - Boutons touch-friendly (min 44x44px)
  - Inputs optimis√©s (font-size 16px √©vite zoom iOS)
  - FAB (Floating Action Button) pour actions rapides
  - Modal fullscreen sur mobile
  - Pull-to-refresh indicator
  - Swipe indicators (gauche/droite)

- **Mobile Gestures** : `mobile-gestures.js`
  - Swipe left/right pour naviguer entre pages
  - Pull-to-refresh pour actualiser
  - Tap-and-hold pour menu contextuel (√† venir)
  - Indicateurs visuels pendant gestures
  - Vibration feedback si support√©
  - Auto-activation sur √©crans < 768px

#### üîß Modifi√©
- **Tous les templates** : Ajout des meta tags PWA
  - `theme-color` : #008B74
  - `apple-mobile-web-app-capable`
  - `apple-mobile-web-app-status-bar-style`
  - Liens vers manifest.json et ic√¥nes
  - Chargement des scripts temps r√©el et PWA

- **Template aquaponie.twig** :
  - Badge LIVE fixe en haut √† droite
  - Panneau "√âtat du syst√®me" avec 4 m√©triques temps r√©el
  - Scripts d'initialisation du polling
  - Countdown "Prochaine mise √† jour"

- **Template dashboard.twig** :
  - Meta tags PWA
  - Chargement CSS et JS temps r√©el

- **Template control.twig** :
  - Meta tags PWA
  - Pr√©paration pour synchronisation temps r√©el GPIO

- **Repository SensorReadRepository** :
  - Nouvelle m√©thode `getReadingsSince(string $sinceDate)`
  - Nouvelle m√©thode `countReadingsBetween(string $start, string $end)`

#### üì¶ D√©pendances
- **Ajout√©** : `minishlink/web-push: ^8.0` (notifications push navigateur)
- **Ajout√©** : `bacon/bacon-qr-code: ^2.0` (g√©n√©ration QR codes)

#### ‚öôÔ∏è Configuration
- **Nouvelles variables .env** :
  - `REALTIME_POLLING_INTERVAL` : Intervalle de polling (d√©faut 15s)
  - `REALTIME_ENABLE_NOTIFICATIONS` : Activer notifications (d√©faut true)
  - `PUSH_VAPID_PUBLIC_KEY` : Cl√© publique VAPID (√† g√©n√©rer)
  - `PUSH_VAPID_PRIVATE_KEY` : Cl√© priv√©e VAPID (√† g√©n√©rer)
  - `PUSH_ADMIN_EMAIL` : Email admin pour push
  - `PWA_ENABLE_OFFLINE` : Activer mode offline (d√©faut true)
  - `PWA_CACHE_VERSION` : Version du cache (d√©faut 1.0.0)

#### üìù Fichiers cr√©√©s
- `src/Controller/RealtimeApiController.php`
- `src/Service/RealtimeDataService.php`
- `public/assets/js/toast-notifications.js`
- `public/assets/js/realtime-updater.js`
- `public/assets/js/pwa-init.js`
- `public/assets/js/mobile-gestures.js`
- `public/assets/css/realtime-styles.css`
- `public/assets/css/mobile-optimized.css`
- `public/manifest.json`
- `public/service-worker.js`
- `public/assets/icons/generate-icons.php` (script g√©n√©ration ic√¥nes)

#### üé® UX/UI
- **Badge LIVE** : Indicateur temps r√©el avec animations
- **Toast notifications** : Feedback visuel non-intrusif
- **Dashboard syst√®me** : M√©triques en temps r√©el
- **Mobile gestures** : Navigation intuitive sur tactile
- **Bottom nav** : Acc√®s rapide aux sections principales
- **Responsive am√©lior√©** : Adaptation parfaite mobile/tablette/desktop

#### üöÄ Performance
- **Polling optimis√©** : Requ√™tes l√©g√®res (JSON)
- **Cache intelligent** : Service worker avec fallback
- **Lazy loading** : Scripts charg√©s apr√®s DOM ready
- **Mode pause** : Arr√™t du polling si onglet inactif

#### üîí S√©curit√©
- **API endpoints** : Authentification via syst√®me existant
- **CORS** : Headers appropri√©s pour API REST
- **Service worker** : Validation des requ√™tes

#### üì± Compatibilit√©
- **Navigateurs** : Chrome, Firefox, Safari, Edge
- **PWA** : Support complet Chrome/Edge, partiel Safari
- **Touch events** : D√©tection automatique
- **Fallbacks** : D√©gradation gracieuse si PWA non support√©

#### üìä M√©triques
- **Uptime** : Calcul√© sur 30 jours
- **Latence** : Estimation 3.5s moyenne
- **Fr√©quence** : Lectures attendues toutes les 3 minutes
- **Lectures/jour** : Compteur en temps r√©el

### üéØ √Ä venir (Roadmap)
- [ ] Notifications push navigateur (infrastructure pr√™te)
- [ ] QR codes intelligents pour acc√®s rapide
- [ ] Mise √† jour temps r√©el des graphiques Highcharts
- [ ] Synchronisation temps r√©el des GPIO dans interface contr√¥le
- [ ] Tests unitaires pour nouveaux services
- [ ] Mode offline complet avec cache √©tendu
- [ ] Graphiques optimis√©s mobile (fullscreen, gestures)

### üìã Migration
Pour migrer vers v4.0.0 :
1. `git pull` pour r√©cup√©rer les derni√®res modifications
2. `composer update` pour installer nouvelles d√©pendances
3. V√©rifier les nouvelles variables `.env` (optionnelles)
4. Tester le badge LIVE et le dashboard syst√®me
5. Sur mobile, tester le bouton d'installation PWA
6. G√©n√©rer les cl√©s VAPID si notifications push souhait√©es :
   ```bash
   ./vendor/bin/web-push generate-vapid-keys
   ```

### ‚ö†Ô∏è Notes importantes
- **Polling** : G√©n√®re 4 requ√™tes/minute par utilisateur actif
- **Cache** : V√©rifier espace disque pour cache service worker
- **Mobile** : Tester sur vrais appareils iOS/Android
- **Offline** : Mode d√©grad√©, pas toutes les fonctionnalit√©s

---

## [3.1.0] - 2025-10-10

### üêõ Sprint 3 - Am√©liorations Qualit√© & Corrections

#### Corrig√©
- **Bug critique CleanDataCommand** : `checkWaterLevels()` utilisait `min()` au lieu de la derni√®re lecture r√©elle
  - Maintenant utilise `SensorReadRepository->getLastReadings()` pour obtenir la vraie derni√®re valeur
  - Fix potentiel de fausses alertes de niveau d'eau bas

#### ‚ú® Ajout√©
- **RestartPumpCommand** : Nouvelle commande pour g√©rer le red√©marrage diff√©r√© des pompes
  - Remplace le `sleep(300)` bloquant dans ProcessTasksCommand
  - Utilise un syst√®me de flag file pour programmer les red√©marrages
  - Permet au CRON de ne plus √™tre bloqu√© pendant 5 minutes
  
- **Tests unitaires** : Am√©lioration de la couverture (+15%)
  - `ChartDataServiceTest` : Tests complets du service de charts
  - `StatisticsAggregatorServiceTest` : Tests d'agr√©gation des stats
  - `EnvironmentMiddlewareTest` : Tests du middleware d'environnement
  
- **Documentation legacy** : `LEGACY_README.md`
  - Documentation compl√®te de tous les fichiers legacy
  - Statut de chaque fichier (Actif/Obsol√®te/√Ä supprimer)
  - Plan de migration d√©taill√©

#### üîß Modifi√©
- **ProcessTasksCommand** : `checkTideSystem()` ne bloque plus avec `sleep(300)`
  - Cr√©e un flag file pour red√©marrage programm√©
  - Log clair indiquant qu'un red√©marrage est pr√©vu dans 5 minutes
  - √Ä coupler avec `RestartPumpCommand` dans le CRON

#### üìù Documentation
- **LEGACY_README.md** : Guide complet des fichiers legacy
- **Tests** : +3 fichiers de tests (couverture en progression)

---

## [3.0.0] - 2025-10-10 üöÄ BREAKING CHANGES

### ‚ö° Sprint 2 - Refactoring Architectural Majeur

#### üí• Breaking Changes
- **Injection de d√©pendances (DI)** : Impl√©mentation de PHP-DI v7
  - Tous les contr√¥leurs utilisent maintenant l'injection de d√©pendances
  - N√©cessite `composer update` pour installer PHP-DI
  - Les contr√¥leurs ne peuvent plus √™tre instanci√©s manuellement sans le container

#### ‚ú® Ajout√©
- **Container DI** : `config/container.php` et `config/dependencies.php`
  - Gestion centralis√©e de toutes les d√©pendances
  - Autowiring automatique pour les contr√¥leurs
  - Cache de compilation en production pour meilleures performances
  
- **Nouveaux Services**
  - `ChartDataService` : Pr√©paration des donn√©es pour Highcharts
    - `prepareSeriesData()` : Toutes les s√©ries (EauAquarium, TempAir, etc.)
    - `prepareTimestamps()` : Timestamps en ms epoch UTC
    - `extractLastReadings()` : Derni√®res valeurs des capteurs
  - `StatisticsAggregatorService` : Agr√©gation des statistiques
    - `aggregateAllStats()` : Stats pour tous les capteurs en une fois
    - `aggregateForSensor()` : Stats pour un capteur sp√©cifique
    - `flattenForLegacy()` : Format compatible legacy (min_tempair, max_tempair, etc.)

- **EnvironmentMiddleware** : Gestion automatique des environnements PROD/TEST
  - Appliqu√© automatiquement sur les groupes de routes TEST
  - √âlimine la duplication `TableConfig::setEnvironment()` dans chaque route

- **M√©thodes OutputService** :
  - `updateStateById()` : Mise √† jour d'un output par ID
  - `updateMultipleParameters()` : Mise √† jour batch de plusieurs param√®tres

#### üîß Refactoris√©
- **AquaponieController** : R√©duit de 301 √† ~180 lignes (-40%)
  - Utilise ChartDataService et StatisticsAggregatorService
  - Extraction de m√©thodes priv√©es (`extractDateRange`, `calculateDuration`, `exportCsv`)
  - Injection de d√©pendances dans le constructeur
  - Suppression des variables interm√©diaires r√©p√©titives

- **OutputController** : Simplifi√© et nettoy√©
  - D√©l√®gue toute la logique SQL √† OutputService
  - Plus de requ√™tes SQL directes dans le contr√¥leur
  - M√©thodes `toggleOutput()` et `updateParameters()` r√©duites de 50%

- **public/index.php** : R√©duit de 183 √† ~95 lignes (-48%)
  - Utilisation du container DI pour tous les contr√¥leurs
  - Groupes de routes (`$app->group()`) pour TEST
  - EnvironmentMiddleware appliqu√© sur le groupe TEST
  - √âlimine la duplication massive des routes TEST

#### üì¶ D√©pendances
- **Ajout√©** : `php-di/php-di: ^7.0`
- **Mise √† jour** : `slim/psr7: ^1.6`

#### üìù Architecture
- S√©paration claire des responsabilit√©s (Controllers, Services, Repositories)
- Testabilit√© grandement am√©lior√©e gr√¢ce √† l'injection de d√©pendances
- Code plus maintenable et √©volutif
- R√©duction significative de la duplication de code

---

## [2.9.0] - 2025-10-10

### üêõ Corrig√© (Sprint 1 - Corrections Critiques)
- **Nettoyage lignes vides excessives** : Suppression des lignes vides inutiles dans tous les fichiers PHP
  - `src/Config/Database.php` : R√©duit de 87 √† 44 lignes
  - `src/Service/SensorStatisticsService.php` : R√©duit de 260 √† 128 lignes
  - `src/Repository/SensorReadRepository.php` : Nettoy√© et optimis√©
  - `src/Repository/SensorRepository.php` : Nettoy√© et optimis√©
  - `src/Service/LogService.php` : Nettoy√© et optimis√©
  - `src/Controller/ExportController.php` : Nettoy√© et optimis√©
  - `src/Security/SignatureValidator.php` : Nettoy√© et optimis√©
  - Am√©lioration significative de la lisibilit√© et maintenabilit√© du code

- **Tables SQL en dur corrig√©es** : `AquaponieController.php`
  - Ligne 194 : Utilise maintenant `TableConfig::getDataTable()` au lieu de 'ffp3Data' en dur
  - Ligne 218 : M√™me correction pour la requ√™te MAX(id)
  - Respect de l'environnement TEST d√©sormais garanti

### ‚ú® Ajout√©
- **Middleware de gestion d'erreurs** : `ErrorHandlerMiddleware`
  - Capture toutes les exceptions non g√©r√©es
  - Log d√©taill√© via LogService (message, fichier, ligne, trace, URL, m√©thode)
  - R√©ponse HTTP 500 standardis√©e en cas d'erreur
  - Int√©gr√© dans `public/index.php`

- **Cache Twig activ√© en production** : `TemplateRenderer.php`
  - Cache automatique dans `/var/cache/twig/` en environnement prod
  - D√©sactiv√© en environnement dev pour faciliter le d√©veloppement
  - Am√©lioration significative des performances de rendu

- **Script de nettoyage** : `tools/cleanup_whitespace.php`
  - Outil automatique pour nettoyer les lignes vides excessives
  - R√®gles : max 1 ligne vide entre m√©thodes, aucune dans les blocs de code
  - R√©utilisable pour mainten

ance future

### üîß Modifi√©
- **`.gitignore`** : Ajout de `desktop.ini` et `/var/cache/`
- **`LogService`** : Ajout @deprecated sur `sendAlertEmail()` (√† d√©placer dans NotificationService)

### üìù Documentation
- **Rapport d'audit complet** : `AUDIT_PROJET.md`
  - Analyse d√©taill√©e de tout le projet
  - Identification de 18 probl√®mes (4 critiques, 7 majeurs, 7 mineurs)
  - Plan d'action sur 3 sprints
  - Recommandations d'am√©liorations long terme

---

## [2.8.0] - 2025-10-10

### ‚ú® Ajout√©
- **Page d'accueil moderne** : Nouvelle page `index.html` avec pr√©sentation des projets IoT
  - Design moderne avec cartes de projets (FFP3, MSP1, N3PP)
  - Banni√®re informative sur le projet p√©dagogique olution
  - Grille de statistiques pour chaque projet
  - Section technologies utilis√©es (ESP32, PHP, MySQL, Highcharts, Bootstrap)
  - Liens utiles vers olution.info, farmflow et GitHub
  - Style coh√©rent avec les autres pages (m√™me charte graphique)

### üîß Modifi√©
- **Navigation unifi√©e** : Onglets harmonis√©s sur toutes les pages
  - "Accueil" au lieu de "olution" (navigation coh√©rente)
  - "L'aquaponie (FFP3)" au lieu de "L'aquaponie" ou "le prototype farmflow 3"
  - "Le potager" uniformis√© partout
  - "L'√©levage d'insectes" uniformis√© partout
  - Tous les liens vers l'accueil pointent vers `index.html` au lieu de `index.php`
- **Templates mis √† jour** : aquaponie.twig, dashboard.twig, control.twig, tide_stats.twig
  - Header logo pointe vers index.html
  - Onglet actif mis en √©vidence sur chaque page

### üé® UX/UI
- **Coh√©rence visuelle totale** : Navigation identique sur toutes les pages
- **Identification claire** : Le nom des projets est explicite dans les onglets
- **Page d'accueil attractive** : Pr√©sentation claire et moderne des 3 projets
- **Cartes interactives** : Effets hover sur les cartes de projets
- **Responsive** : Adaptation mobile/tablette/desktop de la page d'accueil

### üì± Structure
- **index.html** remplace la redirection `index.php`
- Accueil accessible depuis toutes les pages via navigation
- Point d'entr√©e clair pour d√©couvrir les projets

---

## [2.7.0] - 2025-10-10

### ‚ú® Ajout√©
- **Support des redirections legacy** : Les anciennes URL redirigent vers les nouvelles routes Slim
- **Gestion de session** : Transfert des donn√©es POST lors des redirections pour compatibilit√© compl√®te
- **Compatibilit√© r√©troactive totale** : QR codes et liens legacy continuent de fonctionner

### üîß Modifi√©
- **ffp3-data.php** : Transform√© en redirection vers `/aquaponie` (PROD)
  - Transfert des param√®tres POST via session
  - Transfert des param√®tres GET via query string
- **ffp3-data2.php** : Am√©lioration de la redirection vers `/aquaponie-test` (TEST)
  - Ajout transfert des param√®tres GET
- **post-ffp3-data.php** : Modernis√© pour utiliser PostDataController (PROD)
  - Force l'environnement PROD
  - Utilise le contr√¥leur moderne au lieu du code SQL legacy
- **AquaponieController.php** : Support des donn√©es POST transf√©r√©es via session
  - R√©cup√©ration automatique des donn√©es de session lors de redirections
  - Compatibilit√© avec les anciennes pages PHP

### üóëÔ∏è Nettoyage
- **Suppression templates obsol√®tes** :
  - `templates/ffp3-data.php` (remplac√© par aquaponie.twig)
  - `templates/dashboard.php` (remplac√© par dashboard.twig)

### üîó Mapping des redirections

#### Pages de visualisation
- `ffp3-data.php` ‚Üí `/aquaponie` (PROD)
- `ffp3-data2.php` ‚Üí `/aquaponie-test` (TEST)

#### Endpoints ESP32
- `post-ffp3-data.php` ‚Üí PostDataController (PROD)
- `post-ffp3-data2.php` ‚Üí PostDataController (TEST)

### ‚ö° Avantages
- **QR Codes op√©rationnels** : Les anciens QR codes continuent de fonctionner
- **Liens externes pr√©serv√©s** : Pas besoin de mettre √† jour les liens externes
- **Migration transparente** : Transition fluide de l'ancien au nouveau syst√®me
- **Code nettoy√©** : Suppression de 1200+ lignes de code legacy dans ffp3-data.php

---

## [2.6.0] - 2025-10-10

### ‚ú® Ajout√©
- **Harmonisation compl√®te du style graphique** sur toutes les pages
- **Dashboard modernis√©** : Cartes de statistiques, tableaux modernes, headers avec ic√¥nes
- **Tide Stats modernis√©** : Cartes de statistiques pour mar√©es, graphiques dans conteneurs blancs, filtrage moderne

### üîß Modifi√© - Dashboard (dashboard.twig)
- **Header et navigation** : Int√©gration du template olution.info avec menu complet
- **Cartes de statistiques** : Remplacement des listes par des cartes modernes avec ic√¥nes
- **Tableaux** : Design moderne avec d√©grad√©s verts dans les headers
- **Banni√®re p√©riode** : Affichage moderne avec gradient et informations centralis√©es
- **Section headers** : Ic√¥nes et bordures color√©es coh√©rentes avec aquaponie

### üîß Modifi√© - Tide Stats (tide_stats.twig)
- **Header et navigation** : Int√©gration du template olution.info avec menu complet
- **Cartes de statistiques** : 3 sections avec cartes (R√©sultats principaux, Variations r√©serve, DiffMaree)
- **Graphiques Chart.js** : Conteneurs blancs avec titres et ombres
- **Filtrage modernis√©** : Boutons rapides et formulaire dans section d√©di√©e
- **Couleurs th√©matiques** : Vert (positif), Rouge (n√©gatif), Bleu (global)
- **Ic√¥nes sp√©cifiques** : Fl√®ches, vagues, graphiques pour chaque type de donn√©e

### üé® UX/UI
- **Coh√©rence visuelle** : M√™me charte graphique sur toutes les pages (aquaponie, dashboard, tide-stats, control)
- **Headers uniformis√©s** : Ic√¥nes et bordures vertes pour toutes les sections
- **Cartes modernes** : Ombres, hover effects, bordures arrondies partout
- **Responsive** : Adaptation automatique mobile sur toutes les pages
- **Navigation unifi√©e** : Menu identique avec liens olution.info et farmflow

### üì± Responsive
- **Grilles adaptatives** : Stats-grid et quick-filters s'adaptent √† l'√©cran
- **Layout mobile** : 1 colonne sur petits √©crans pour toutes les pages

---

## [2.5.0] - 2025-10-10

### ‚ú® D√©cision finale
- **Version D adopt√©e comme version unique** : Suppression des versions A, B et C
- **S√©lecteur de version retir√©** : Interface simplifi√©e
- **Code nettoy√©** : Suppression de ~500 lignes de code inutilis√© (versions A, B, C)

### üîß Modifications
- **createVersionD()** : Seule fonction de cr√©ation de graphiques conserv√©e
- **Graphiques finaux** : Stock Navigator + Aires color√©es + Scatter pour √©quipements
- **CSS all√©g√©** : Suppression des styles du s√©lecteur de version
- **HTML simplifi√©** : Conteneurs D uniquement, plus de divs cach√©s

### üìä Graphiques conserv√©s
- **Niveaux d'eau** : Aires color√©es avec zones de r√©f√©rence (critique/optimal/attention) + scatter pour pompes et chauffage
- **Param√®tres physiques** : Aires color√©es sur 3 axes Y + scatter pour LEDs et nourriture

### ‚ö° Performance
- **Code r√©duit** : 1419 lignes au lieu de 1787 lignes (-368 lignes)
- **Chargement plus rapide** : Plus de lazy loading, un seul jeu de graphiques cr√©√©
- **M√©moire optimis√©e** : Suppression des fonctions et conteneurs inutilis√©s

---

## [2.4.1] - 2025-10-10

### üéØ Modifi√©
- **Version D d√©finie comme version par d√©faut** : S'affiche automatiquement au chargement de la page
  - Bouton Version D en premi√®re position avec ic√¥ne √©toile ‚≠ê
  - Graphiques Version D cr√©√©s et affich√©s au chargement initial
  - Versions A, B, C toujours disponibles via le s√©lecteur mais cach√©es par d√©faut
  - Optimisation : Lazy loading conserv√© pour A, B et C (chargement √† la demande)

### üé® UX/UI
- **Premier bouton** : Version D (actif par d√©faut)
- **Autres boutons** : A, B, C accessibles pour comparaison
- **Chargement optimis√©** : Seule la version D est charg√©e au d√©marrage

---

## [2.4.0] - 2025-10-10

### ‚ú® Ajout√©
- **Version D - Stock + Aires color√©es (Mix B+C)** : Le meilleur des deux mondes !
  - **Stock Navigator** de la version B : Range selector, navigation avanc√©e, scrollbar
  - **Aires color√©es** de la version C : Graphiques areaspline avec d√©grad√©s
  - **Zones de r√©f√©rence** : PlotBands avec zones critique/optimal/attention sur niveaux et temp√©ratures
  - **√âtats des actionneurs en scatter** : Points color√©s avec symboles diff√©rents (cercle, carr√©, triangle, diamant)
  - **L√©gendes compl√®tes** : Toutes les s√©ries affich√©es dans la l√©gende
  - **Gradients personnalis√©s** : D√©grad√©s verticaux pour chaque s√©rie d'aires

### üé® Caract√©ristiques Version D

#### Graphique Niveaux d'eau :
- Aires color√©es pour aquarium, r√©serve, potager
- Zones : Rouge (0-15 critique), Vert (15-65 optimal), Orange (65-100 attention)
- √âtats √©quipements en scatter : Pompe aquarium (‚óè), Pompe r√©serve (‚ñ†), Chauffage (‚ñ≤)

#### Graphique Param√®tres physiques :
- 3 axes Y s√©par√©s (temp√©ratures 28%, humidit√© 28%, luminosit√© 28%)
- Aires color√©es pour chaque param√®tre avec d√©grad√©s
- Zones temp√©rature : Bleu (froid), Vert (optimal), Rouge (chaud)
- √âtats √©quipements : LEDs (‚óÜ), Nourriture gros (‚óè), Nourriture petits (‚ñ†)

### üîß Technique
- Type : `areaspline` avec `fillOpacity` et `linearGradient`
- √âtats actionneurs : Type `scatter` avec `filter(p => p[1] > 0)` pour afficher uniquement les ON
- Symboles distincts : circle, square, triangle, diamond
- Transparence : 60-70% pour les scatter points

---

## [2.3.3] - 2025-10-10

### üêõ Corrig√©
- **Hauteurs des colonnes √©quipements uniformis√©es** dans la version B
  - D√©sactivation du stacking : `stacking: null` pour √©viter l'empilement
  - D√©sactivation du grouping : `grouping: false` pour superposer les colonnes
  - Ajout de transparence : `opacity: 0.6` et couleurs RGBA pour voir les chevauchements
  - Suppression des bordures : `borderWidth: 0` pour un rendu plus propre
  - Toutes les barres "ON" ont maintenant la m√™me hauteur (valeur 1)

### üé® Am√©lior√©
- **Colonnes superpos√©es avec transparence** : On peut maintenant voir quand plusieurs √©quipements sont actifs simultan√©ment
- **Couleurs RGBA** : Transparence appliqu√©e aux couleurs des colonnes pour meilleure visibilit√©

---

## [2.3.2] - 2025-10-10

### üêõ Corrig√©
- **Erreur Highcharts Stock corrig√©e** : `Highcharts.stockChart is not a function`
  - Suppression de `highcharts.js` (conflit avec highstock.js)
  - Highstock.js inclut d√©j√† toutes les fonctionnalit√©s de Highcharts standard
  - Modules corrig√©s : Utilisation de `modules/` au lieu de `stock/modules/`
  - Chargement optimis√© : Un seul script principal (highstock.js) au lieu de deux

### ‚ö° Performance
- **Moins de scripts** : 5 scripts au lieu de 6
- **Pas de conflit** entre highcharts.js et highstock.js
- **Chargement plus rapide** : Moins de requ√™tes HTTP

---

## [2.3.1] - 2025-10-10

### üêõ Corrig√©
- **Version B (Stock Navigator) corrig√©e** : Fonctionnement maintenant op√©rationnel
  - Suppression des flags probl√©matiques qui causaient des erreurs JavaScript
  - Ajout d'un 4√®me axe Y pour les √©tats des √©quipements (LEDs, nourriture)
  - Am√©lioration de la hauteur des graphiques (600px et 700px) pour meilleure lisibilit√©
  - Ajout de `inputEnabled: true` pour permettre la saisie manuelle de dates
  - Configuration `showInNavigator` pour afficher les s√©ries principales dans le navigator
  - S√©paration claire des donn√©es : Niveaux/√âtats √©quipements et Temp√©ratures/Humidit√©/Luminosit√©/√âquipements

### üîß Modifi√©
- **Graphique Niveaux d'eau** : 2 axes Y (niveaux 55%, √©tats 35%)
- **Graphique Param√®tres physiques** : 4 axes Y (temp√©ratures 25%, humidit√© 25%, luminosit√© 25%, √©tats 10%)
- **Navigator** : Hauteur fix√©e √† 40px pour meilleure visibilit√©

---

## [2.3.0] - 2025-10-10

### ‚ú® Ajout√©
- **3 versions de graphiques Highcharts** inspir√©es des visualisations m√©t√©o pour am√©liorer la lisibilit√©
  - **Version A - Graphiques empil√©s synchronis√©s** : 4 graphiques s√©par√©s (niveaux, temp√©ratures, humidit√©/lumi√®re, √©quipements) avec zoom synchronis√© style m√©t√©o
  - **Version B - Stock Navigator** : Graphiques Highcharts Stock avec barre de navigation et range selector (1h, 6h, 1j, 1s, 1m)
  - **Version C - Aires color√©es** : Graphiques en aires avec zones de r√©f√©rence (optimal, critique, attention)
- **S√©lecteur de version** : Boutons modernes pour basculer entre les 3 versions de visualisation
- **Bandes temporelles color√©es** : √âtats des √©quipements affich√©s en bandes horizontales (plotBands) sur les graphiques de niveaux d'eau
- **Zones de r√©f√©rence** : Plages de valeurs optimales/critiques visibles dans la version C
- **Module Highcharts Stock** : Ajout du module pour les graphiques avec navigation avanc√©e

### üîß Modifi√©
- **Graphiques s√©par√©s** au lieu de graphiques complexes avec multiples axes Y
- **Synchronisation du zoom** : Les 4 graphiques de la version A se synchronisent automatiquement
- **√âtats √©quipements** : 
  - Version A : Graphique d√©di√© avec toutes les donn√©es
  - Version B : Bandes color√©es (plotBands) sur graphiques principaux
  - Version C : Colonnes int√©gr√©es dans les graphiques
- **Interface graphiques** : Chargement lazy des versions B et C (cr√©√©es uniquement √† la premi√®re s√©lection)

### üé® UX/UI
- **Lisibilit√© am√©lior√©e** : Chaque type de donn√©e a son propre graphique
- **Navigation facilit√©e** : Range selector dans version B pour zoomer rapidement
- **Visualisation claire** : Zones color√©es montrent les plages de valeurs id√©ales
- **Style m√©t√©o** : Graphiques empil√©s comme sur les sites m√©t√©o professionnels
- **Responsive** : Tous les graphiques s'adaptent √† la taille d'√©cran
- **S√©lecteur moderne** : Boutons avec ic√¥nes et effets hover

### üìä Donn√©es
- **Aucune perte de donn√©es** : Toutes les donn√©es sont affich√©es dans chaque version
- **Compatibilit√© maintenue** : Timezone Europe/Paris conserv√©
- **Performance** : Lazy loading des versions B et C pour optimiser le chargement initial

---

## [2.2.4] - 2025-10-10

### üêõ Corrig√©
- **Nouvelle tentative de correction des ic√¥nes** : Utilisation des noms d'ic√¥nes FA5/FA6 universels
  - Retour √† `fas fa-tint` pour "Niveaux d'eau" (compatible FA5/FA6)
  - Retour √† `fas fa-thermometer-half` pour "Param√®tres physiques" (compatible FA5/FA6)
  - Suppression de la classe `icon` qui pourrait causer des conflits CSS

---

## [2.2.3] - 2025-10-10

### üêõ Corrig√©
- **Ic√¥nes Font Awesome manquantes** : Remplacement des ic√¥nes non compatibles
  - `fa-water` ‚Üí `fa-tint` pour "Niveaux d'eau"
  - `fa-temperature-half` ‚Üí `fa-thermometer-half` pour "Param√®tres physiques"
  - `fa-water` ‚Üí `fa-thermometer` pour "Temp√©rature eau"
- Les ic√¥nes s'affichent maintenant correctement au lieu de rectangles avec croix

---

## [2.2.2] - 2025-10-10

### üé® Am√©lior√©
- **Graphiques param√©triques chimiques centr√©s** : Meilleur alignement visuel des 3 cartes de graphiques
- **Largeur maximale** des cartes fix√©e √† 650px pour une coh√©rence visuelle
- **Grille centr√©e** avec largeur maximale de 1800px pour √©viter l'√©tirement excessif sur grands √©crans

---

## [2.2.1] - 2025-10-10

### üé® Am√©lior√©
- **Interface de filtrage des donn√©es** compl√®tement redessin√©e pour une ergonomie optimale
- **Carte d√©di√©e au filtrage** : Section visuellement distincte avec fond blanc, ombres et bordure color√©e
- **Inputs datetime-local** : Champs date et heure unifi√©s au lieu de 4 champs s√©par√©s
- **Boutons de p√©riode rapide** am√©lior√©s avec ic√¥nes et effets hover
- **Panneau d'information** : Affichage en temps r√©el de la p√©riode analys√©e avec gradient moderne
- **Statistiques visibles** : Dur√©e d'analyse, nombre d'enregistrements et dur√©e totale de fonctionnement affich√©s en haut
- **Bouton CSV int√©gr√©** : Export CSV directement dans la section de filtrage, plus besoin de chercher
- **Design responsive** : Adaptation automatique pour mobile, tablette et desktop
- **Animations et transitions** : Effets visuels fluides sur hover et focus

### üîß Technique
- **R√©trocompatibilit√©** : Support des anciens param√®tres `start_date`/`start_time` et nouveaux `start_datetime`
- **Contr√¥leur adapt√©** : `AquaponieController` g√®re les deux formats de dates automatiquement
- **JavaScript optimis√©** : Fonction `setPeriod()` mise √† jour pour les nouveaux inputs
- **Code CSS modulaire** : Classes r√©utilisables pour les futurs filtres

### üì± Responsive
- **Mobile-first** : Layout adapt√© pour les petits √©crans
- **Grille flexible** : Ajustement automatique selon la taille d'√©cran
- **Touch-friendly** : Boutons et inputs dimensionn√©s pour l'utilisation tactile

---

## [2.2.0] - 2025-10-10

### ‚ú® Ajout√©
- **Cartes de statistiques modernes** sur page aquaponie rempla√ßant les anciennes jauges semi-circulaires
- **Ic√¥nes Font Awesome** pour chaque type de mesure (üíß eau, üå°Ô∏è temp√©rature, üí° lumi√®re, etc.)
- **Progress bars anim√©es** avec d√©grad√©s de couleurs par th√©matique
- **Effet hover** sur les cartes de statistiques pour interactivit√©
- **Headers de section** avec ic√¥nes et bordures color√©es

### üîß Modifi√©
- **Jauges semi-circulaires** ‚Üí Cartes modernes avec valeurs en grand format
- **Statistiques visuelles** : Min/Max/Moy affich√©s de mani√®re compacte sous chaque carte
- **Palette de couleurs** coh√©rente : Bleu (eau), Rouge (temp√©rature), Violet (humidit√©), Jaune (lumi√®re)
- **Layout responsive** : Grille adaptative pour mobile, tablette, desktop
- **JavaScript** : Fonctions modernis√©es pour mettre √† jour les cartes au lieu des jauges
- **Interface contr√¥le** : Email en vert clair pour se distinguer des autres param√®tres

### üé® UX/UI
- Interface **plus moderne et lisible** avec cartes √©pur√©es
- **Identification rapide** gr√¢ce aux ic√¥nes et couleurs
- **Animations fluides** (transform, width transition)
- **Compatibilit√©** : Fonctionne avec les m√™mes donn√©es et APIs

---

## [2.1.0] - 2025-10-10

### ‚ú® Ajout√©
- **Ic√¥nes Font Awesome** pour chaque actionneur (üíß eau, üå°Ô∏è temp√©rature, üí° lumi√®re, üêü poissons, üîÑ reset)
- **Layout 2 colonnes** sur √©cran desktop (>1200px) pour √©viter le scroll
- **Version du projet** affich√©e en pied de page sur toutes les pages
- **Syst√®me de versionnage centralis√©** avec fichier `VERSION` et classe `Version.php`
- **CHANGELOG.md** : Documentation compl√®te de toutes les versions

### üîß Modifi√©
- **Interface de contr√¥le** enti√®rement redesign√©e avec sections th√©matiques color√©es
- **Formulaires compacts** : Labels raccourcis, padding r√©duit, grille optimis√©e
- **Actionneurs organis√©s** en grille responsive avec ic√¥nes et switches r√©duits
- **Param√®tres group√©s** par cat√©gorie (üìß Notifications, üíß Eau, üå°Ô∏è Chauffage, üêü Nourrissage, üîß Syst√®me)
- **Filtrage des boards** : Affichage uniquement des boards actives pour l'environnement (PROD ou TEST)
- **Responsive am√©lior√©** : Layout adaptatif selon taille d'√©cran (desktop, tablette, mobile)

### üêõ Corrig√©
- **Bug CSS** : Affichage cass√© au chargement qui se corrigeait √† l'ouverture de l'inspecteur
  - Ajout de `!important` pour surcharger le CSS du template
  - Force reflow JavaScript au chargement
  - Transition opacity pour masquer le calcul initial
- **Timing formulaire** : D√©lai augment√© √† 1,5s avec transaction SQL pour √©viter l'affichage des anciennes valeurs
- **Affichage boards** : Filtrage par environnement pour √©viter de m√©langer PROD et TEST

### üé® UX/UI
- Interface **sans scroll** sur √©cran desktop standard (1920x1080)
- **Sections visuellement distinctes** avec codes couleur par th√©matique
- **Actions rapides compactes** avec ic√¥nes (‚öôÔ∏è Cron, üìã Journal, üìä Donn√©es)
- **Badges d'environnement** : Indication claire (TEST) en orange
- **Ic√¥nes coh√©rentes** dans toute l'interface pour identification rapide

---

## [2.0.0] - 2025-10-08

### ‚ú® Ajout√©
- **Architecture TEST/PROD compl√®te** : Environnements s√©par√©s avec tables distinctes
- **Module de contr√¥le moderne** : Interface web pour GPIO avec routes `/control` et `/control-test`
- **API REST compl√®te** pour contr√¥le outputs :
  - `GET /api/outputs/state` - √âtat des GPIO
  - `GET /api/outputs/toggle?id=X&state=Y` - Toggle GPIO
  - `POST /api/outputs/parameters` - Mise √† jour param√®tres
- **Nouveaux composants** :
  - `TableConfig` : Gestion dynamique des tables selon environnement
  - `OutputRepository` : Gestion des GPIO en base de donn√©es
  - `BoardRepository` : Gestion des cartes ESP32
  - `OutputService` : Logique m√©tier pour contr√¥les
  - `OutputController` : Contr√¥leur Slim pour interface de contr√¥le
- **Routes TEST** : `/dashboard-test`, `/aquaponie-test`, `/control-test`, `/post-data-test`
- **Documentation compl√®te** :
  - `ENVIRONNEMENT_TEST.md` : Guide TEST/PROD
  - `RECAPITULATIF_MIGRATION.md` : Synth√®se migration
  - `TODO_AMELIORATIONS_CONTROL.md` : Roadmap am√©liorations

### üîß Modifi√©
- **Repositories** : Utilisation de `TableConfig` pour s√©lection dynamique des tables
- **Services** : Adaptation pour supporter PROD et TEST
- **Interface de contr√¥le** : Ordre des switches personnalis√©, nettoyage des intitul√©s
- **Formulaire param√®tres** : Gestion correcte des types (string pour mail, int pour autres)
- **Toggle GPIO** : Utilisation de l'ID de base au lieu du GPIO (compatibilit√© legacy)

### üêõ Corrig√©
- Affichage des switches dans le bon ordre (pompe aqua, pompe r√©serve, radiateurs, lumi√®re, nourrisseurs, reset)
- Suppression mention "(stopp√©e/stopp√©s si relais activ√©)" des intitul√©s
- Affichage des GPIO 108, 109, 110 (nourrisseurs et reset)
- Gestion des param√®tres email et notifications dans formulaire
- Logs de debug pour diagnostic des probl√®mes de toggle

### üîí S√©curit√©
- Pr√©paration pour authentification HTTP Basic sur `/control`
- Validation des param√®tres dans les API

---

## [1.x.x] - Versions pr√©c√©dentes

### Fonctionnalit√©s existantes
- Dashboard avec graphiques Highcharts
- Visualisation donn√©es aquaponie
- Export CSV des donn√©es
- API ESP32 pour post de donn√©es
- Timezone unifi√© Europe/Paris
- Statistiques mar√©es (tide stats)
- Gestion GPIO legacy via `ffp3control`

---

## Format du versioning

**MAJOR.MINOR.PATCH**

- **MAJOR** : Changements incompatibles avec versions pr√©c√©dentes
- **MINOR** : Ajout de fonctionnalit√©s r√©trocompatibles
- **PATCH** : Corrections de bugs

---

*Ce changelog sera mis √† jour √† chaque release significative.*

