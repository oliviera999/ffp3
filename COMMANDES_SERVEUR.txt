================================================================================
üöÄ COMMANDES √Ä EX√âCUTER SUR LE SERVEUR - FFP3 v4.0.0
================================================================================

üìã √âTAPES :

1. Connectez-vous en SSH
2. Copiez-collez les commandes ci-dessous
3. V√©rifiez que tout fonctionne

================================================================================
CONNEXION SSH
================================================================================

ssh oliviera@toaster

================================================================================
COMMANDES DE D√âPLOIEMENT (Copier-Coller Bloc Complet)
================================================================================

cd /home4/oliviera/iot.olution.info/ffp3

echo "üì• Pull depuis GitHub..."
git pull origin main

echo "üóëÔ∏è  Suppression vendor/ corrompu..."
rm -rf vendor/

echo "üì¶ Installation des d√©pendances..."
composer update --no-dev --optimize-autoloader

echo "üîç V√©rifications..."
ls vendor/php-di/ > /dev/null 2>&1 && echo "‚úÖ PHP-DI install√©" || echo "‚ùå PHP-DI manquant"
ls vendor/minishlink/ > /dev/null 2>&1 && echo "‚úÖ web-push install√©" || echo "‚ùå web-push manquant"
ls vendor/bacon/ > /dev/null 2>&1 && echo "‚úÖ bacon-qr-code install√©" || echo "‚ùå bacon-qr-code manquant"

echo "üß™ Test autoload..."
php -r "require 'vendor/autoload.php'; use DI\ContainerBuilder; echo 'OK\n';"

echo "üìå Version d√©ploy√©e:"
cat VERSION

echo ""
echo "=========================================="
echo "üéâ D√âPLOIEMENT TERMIN√â !"
echo "=========================================="

================================================================================
OU VERSION ULTRA-COURTE (1 ligne)
================================================================================

cd /home4/oliviera/iot.olution.info/ffp3 && git pull && rm -rf vendor/ && composer update --no-dev --optimize-autoloader && php -r "require 'vendor/autoload.php'; echo '\n‚úÖ D√âPLOIEMENT OK\n';" && cat VERSION

================================================================================
OU AVEC LE SCRIPT AUTOMATIQUE
================================================================================

cd /home4/oliviera/iot.olution.info/ffp3
git pull origin main
bash DEPLOY_NOW.sh

================================================================================
V√âRIFICATIONS POST-D√âPLOIEMENT
================================================================================

1. Dans le terminal serveur:

   ls vendor/php-di/
   # Doit afficher des fichiers

2. Test API:

   curl https://iot.olution.info/ffp3/api/realtime/system/health
   # Doit retourner JSON avec {"online":true,...}

3. Test endpoint ESP32:

   curl https://iot.olution.info/ffp3/ffp3datas/api/outputs/state
   # Doit retourner JSON avec √©tats GPIO

4. Dans le navigateur:

   https://iot.olution.info/ffp3/ffp3datas/
   
   V√©rifier:
   ‚úÖ Page se charge (pas erreur 500)
   ‚úÖ Badge LIVE visible en haut √† droite
   ‚úÖ Badge devient vert apr√®s 15 secondes
   ‚úÖ Dashboard "√âtat du syst√®me" affiche m√©triques
   ‚úÖ Console (F12) montre logs [RealtimeUpdater]

================================================================================
EN CAS DE PROBL√àME
================================================================================

Si erreur "Class DI\ContainerBuilder not found" persiste:

1. V√©rifier que composer update s'est bien pass√©:
   composer show | grep php-di
   # Doit afficher: php-di/php-di x.x.x

2. Forcer reg√©n√©ration autoload:
   composer dump-autoload --optimize

3. V√©rifier permissions:
   chmod -R 755 vendor/

4. Si toujours erreur, r√©p√©ter:
   rm -rf vendor/
   composer install --no-dev

================================================================================
SUCC√àS ATTENDU
================================================================================

Apr√®s d√©ploiement, vous devriez voir:

‚úÖ vendor/php-di/ existe
‚úÖ vendor/minishlink/ existe  
‚úÖ vendor/bacon/ existe
‚úÖ php -r "require 'vendor/autoload.php';" ‚Üí Pas d'erreur
‚úÖ https://iot.olution.info/ffp3/ffp3datas/ ‚Üí Page charge
‚úÖ Badge LIVE ‚Üí Devient vert
‚úÖ Dashboard syst√®me ‚Üí Affiche uptime, lectures, etc.
‚úÖ ESP32 ‚Üí Continue de fonctionner sans changement

================================================================================
DOCUMENTATION
================================================================================

Sur le serveur apr√®s d√©ploiement:

  cat ESP32_API_REFERENCE.md      # API ESP32 compl√®te
  cat QUICKSTART_V4.md             # Guide d√©marrage rapide
  cat IMPLEMENTATION_REALTIME_PWA.md # Guide technique

================================================================================
FIN DES COMMANDES
================================================================================

